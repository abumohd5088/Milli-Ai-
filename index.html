<!DOCTYPE html>
<html lang="hi" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Milli AI - AI School Assistant</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --primary: #4338ca;
      --primary-light: #665fd1;
      --secondary: #f59e0b;
      --dark: #1f2937;
      --light: #f9fafb;
      --gray: #6b7280;
      --danger: #ef4444;
      --success: #10b981;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --radius: 12px;
    }

    .dark-theme {
      --dark: #f9fafb;
      --light: #1f2937;
      --gray: #9ca3af;
      --shadow: 0 4px 6px -1px rgba(255, 255, 255, 0.1), 0 2px 4px -1px rgba(255, 255, 255, 0.06);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }

    body {
      background-color: var(--light);
      color: var(--dark);
      transition: all 0.3s ease;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    body.dark-theme {
      background-color: var(--dark);
      color: var(--light);
    }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
      background-color: var(--primary);
      color: white;
      box-shadow: var(--shadow);
      z-index: 100;
    }

    .header-title {
      font-size: 1.2rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .header-actions {
      display: flex;
      gap: 16px;
    }

    .material-icons {
      cursor: pointer;
      font-size: 24px;
    }

    /* Main Chat Area */
    .chat-container {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .message {
      max-width: 80%;
      padding: 12px 16px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      animation: fadeIn 0.3s ease;
    }

    .user-message {
      align-self: flex-end;
      background-color: var(--primary-light);
      color: white;
    }

    .ai-message {
      align-self: flex-start;
      background-color: var(--light);
      color: var(--dark);
    }

    .dark-theme .ai-message {
      background-color: #374151;
      color: var(--light);
    }

    .message-options {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      font-size: 14px;
    }

    .message-option {
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 6px;
      background-color: rgba(0, 0, 0, 0.05);
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .dark-theme .message-option {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .message-option:hover {
      background-color: rgba(0, 0, 0, 0.1);
    }

    .dark-theme .message-option:hover {
      background-color: rgba(255, 255, 255, 0.2);
    }

    .typing-indicator {
      align-self: flex-start;
      background-color: var(--light);
      padding: 12px 16px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      display: flex;
      gap: 4px;
    }

    .dark-theme .typing-indicator {
      background-color: #374151;
    }

    .typing-dot {
      width: 8px;
      height: 8px;
      background-color: var(--gray);
      border-radius: 50%;
      animation: typingAnimation 1.4s infinite ease-in-out;
    }

    .typing-dot:nth-child(1) { animation-delay: 0s; }
    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }

    /* Input Area */
    .input-container {
      padding: 16px;
      background-color: var(--light);
      border-top: 1px solid rgba(0, 0, 0, 0.1);
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .dark-theme .input-container {
      background-color: #1f2937;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .input-field {
      flex: 1;
      padding: 12px 16px;
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: var(--radius);
      font-size: 16px;
      outline: none;
      background-color: var(--light);
      color: var(--dark);
    }

    .dark-theme .input-field {
      background-color: #374151;
      color: var(--light);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .input-field:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(67, 56, 202, 0.2);
    }

    .send-btn, .action-btn {
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: 50%;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: var(--shadow);
      transition: all 0.2s ease;
    }

    .send-btn:hover, .action-btn:hover {
      background-color: var(--primary-light);
      transform: scale(1.05);
    }

    .action-btn {
      background-color: var(--light);
      color: var(--dark);
    }

    .dark-theme .action-btn {
      background-color: #374151;
      color: var(--light);
    }

    /* Bottom Navigation */
    .bottom-nav {
      display: flex;
      justify-content: space-around;
      background-color: var(--primary);
      padding: 12px 0;
      position: fixed;
      bottom: 0;
      width: 100%;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
      z-index: 90;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: white;
      font-size: 12px;
      cursor: pointer;
    }

    .nav-icon {
      font-size: 24px;
      margin-bottom: 4px;
    }

    /* Panels (Settings, Notifications) */
    .panel {
      position: fixed;
      top: 0;
      right: -100%;
      width: 80%;
      max-width: 400px;
      height: 100vh;
      background-color: var(--light);
      color: var(--dark);
      box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
      z-index: 200;
      transition: right 0.3s ease;
      padding: 20px;
      overflow-y: auto;
    }

    .dark-theme .panel {
      background-color: #1f2937;
      color: var(--light);
    }

    .panel.active {
      right: 0;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }

    .dark-theme .panel-header {
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .close-panel {
      cursor: pointer;
      font-size: 24px;
    }

    .panel-section {
      margin-bottom: 24px;
    }

    .panel-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 12px;
    }

    .setting-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    .dark-theme .setting-item {
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 24px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: var(--primary);
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }

    /* Notification Badge */
    .notification-badge {
      position: relative;
    }

    .badge {
      position: absolute;
      top: -4px;
      right: -4px;
      background-color: var(--danger);
      color: white;
      font-size: 10px;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Maintenance Screen */
    .maintenance-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: var(--light);
      color: var(--dark);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 300;
      display: none;
    }

    .dark-theme .maintenance-screen {
      background-color: #1f2937;
      color: var(--light);
    }

    .maintenance-icon {
      font-size: 64px;
      margin-bottom: 20px;
      color: var(--primary);
    }

    .maintenance-title {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .maintenance-message {
      text-align: center;
      max-width: 80%;
      margin-bottom: 20px;
    }

    /* Greeting Message */
    .greeting-message {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 32px 16px;
      text-align: center;
      background-color: var(--light);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin: 0 auto;
      max-width: 80%;
    }

    .dark-theme .greeting-message {
      background-color: #374151;
    }

    .greeting-icon {
      font-size: 48px;
      margin-bottom: 16px;
      color: var(--primary);
    }

    .greeting-text {
      font-size: 18px;
      font-weight: 500;
      margin-bottom: 8px;
    }

    .greeting-subtext {
      font-size: 14px;
      color: var(--gray);
    }

    /* Related Questions */
    .related-questions {
      margin-top: 16px;
      padding: 16px;
      background-color: var(--light);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .dark-theme .related-questions {
      background-color: #374151;
    }

    .related-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--primary);
    }

    .related-question {
      padding: 8px 12px;
      margin-bottom: 8px;
      background-color: rgba(67, 56, 202, 0.1);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .related-question:hover {
      background-color: rgba(67, 56, 202, 0.2);
    }

    /* Top Questions */
    .top-questions {
      margin-bottom: 24px;
    }

    .top-question {
      padding: 12px;
      background-color: var(--light);
      border-radius: var(--radius);
      margin-bottom: 8px;
      box-shadow: var(--shadow);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .dark-theme .top-question {
      background-color: #374151;
    }

    .top-question:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes typingAnimation {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-5px); }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .message {
        max-width: 90%;
      }
      
      .panel {
        width: 90%;
      }
    }
  </style>
</head>
<body>
  <!-- Maintenance Screen -->
  <div class="maintenance-screen" id="maintenanceScreen">
    <span class="material-icons maintenance-icon">construction</span>
    <h2 class="maintenance-title">App Under Maintenance</h2>
    <p class="maintenance-message">We're making improvements to serve you better. Please check back soon!</p>
    <p>Milli AI Team</p>
  </div>

  <!-- Header -->
  <div class="header">
    <div class="header-title">
      <span class="material-icons">school</span>
      <span>Milli AI</span>
    </div>
    <div class="header-actions">
      <div class="notification-badge" id="notificationBadge">
        <span class="material-icons">notifications</span>
        <span class="badge" id="notificationCount">0</span>
      </div>
      <span class="material-icons" id="menuBtn">more_vert</span>
    </div>
  </div>

  <!-- Chat Container -->
  <div class="chat-container" id="chatContainer">
    <!-- Greeting Message will be inserted here by JavaScript -->
  </div>

  <!-- Input Area -->
  <div class="input-container">
    <button class="action-btn" id="micBtn">
      <span class="material-icons">mic</span>
    </button>
    <button class="action-btn" id="fileBtn">
      <span class="material-icons">attach_file</span>
    </button>
    <button class="action-btn" id="imageBtn">
      <span class="material-icons">image</span>
    </button>
    <input type="text" class="input-field" id="messageInput" placeholder="Ask me anything about study..." />
    <button class="send-btn" id="sendBtn">
      <span class="material-icons">send</span>
    </button>
  </div>

  <!-- Bottom Navigation -->
  <div class="bottom-nav">
    <div class="nav-item" id="chatsNav">
      <span class="material-icons nav-icon">chat</span>
      <span>Chats</span>
    </div>
    <div class="nav-item" id="topQuestionsNav">
      <span class="material-icons nav-icon">question_answer</span>
      <span>Top Questions</span>
    </div>
    <div class="nav-item" id="settingsNav">
      <span class="material-icons nav-icon">settings</span>
      <span>Settings</span>
    </div>
  </div>

  <!-- Settings Panel -->
  <div class="panel" id="settingsPanel">
    <div class="panel-header">
      <h3>Settings</h3>
      <span class="material-icons close-panel" id="closeSettings">close</span>
    </div>
    
    <div class="panel-section">
      <h4 class="panel-title">Appearance</h4>
      <div class="setting-item">
        <span>Dark Mode</span>
        <label class="toggle-switch">
          <input type="checkbox" id="themeToggle">
          <span class="slider"></span>
        </label>
      </div>
      <div class="setting-item">
        <span>Language</span>
        <select id="languageSelect">
          <option value="en">English</option>
          <option value="hi">हिंदी</option>
        </select>
      </div>
    </div>
    
    <div class="panel-section">
      <h4 class="panel-title">About</h4>
      <div class="setting-item">
        <span>Developer</span>
        <span class="material-icons">chevron_right</span>
      </div>
      <div class="setting-item">
        <span>School</span>
        <span class="material-icons">chevron_right</span>
      </div>
      <div class="setting-item">
        <span>Terms & Conditions</span>
        <span class="material-icons">chevron_right</span>
      </div>
    </div>
    
    <div class="panel-section">
      <div class="setting-item">
        <span>Logout</span>
        <span class="material-icons">logout</span>
      </div>
    </div>
  </div>

  <!-- Notifications Panel -->
  <div class="panel" id="notificationsPanel">
    <div class="panel-header">
      <h3>Notifications</h3>
      <span class="material-icons close-panel" id="closeNotifications">close</span>
    </div>
    <div id="notificationsList">
      <!-- Notifications will be added here by JavaScript -->
    </div>
  </div>

  <!-- About Developer Panel -->
  <div class="panel" id="aboutDeveloperPanel">
    <div class="panel-header">
      <h3>About Developer</h3>
      <span class="material-icons close-panel" id="closeAboutDeveloper">close</span>
    </div>
    <div class="panel-section">
      <h4 class="panel-title">Abutalha</h4>
      <p>Class: 6, Student of MKPS Balrampur</p>
      <p>Contact: 9839469669</p>
      <p class="greeting-subtext">"Milli AI has been developed by Abutalha, a young visionary student of class 6. This project reflects innovation, future learning, and creativity."</p>
    </div>
  </div>

  <!-- About School Panel -->
  <div class="panel" id="aboutSchoolPanel">
    <div class="panel-header">
      <h3>About School</h3>
      <span class="material-icons close-panel" id="closeAboutSchool">close</span>
    </div>
    <div class="panel-section">
      <h4 class="panel-title">Milli Karwaan Public School, Balrampur (MKPS)</h4>
      <p>Address: Baluha Police Chowki, Balrampur (Uttar Pradesh)</p>
      <p>Contact: 9758919151</p>
      <p class="greeting-subtext">"Education for the future, powered by AI."</p>
    </div>
  </div>

  <!-- Terms Panel -->
  <div class="panel" id="termsPanel">
    <div class="panel-header">
      <h3>Terms & Conditions</h3>
      <span class="material-icons close-panel" id="closeTerms">close</span>
    </div>
    <div class="panel-section">
      <p>By using Milli AI, you agree to our terms and conditions:</p>
      <ol>
        <li>Use the service for educational purposes only.</li>
        <li>Do not misuse or attempt to hack the system.</li>
        <li>All generated content is for educational assistance.</li>
        <li>The school and developer are not responsible for misuse.</li>
        <li>Terms may be updated periodically.</li>
      </ol>
    </div>
  </div>

  <!-- Top Questions Panel -->
  <div class="panel" id="topQuestionsPanel">
    <div class="panel-header">
      <h3>Top 10 Questions</h3>
      <span class="material-icons close-panel" id="closeTopQuestions">close</span>
    </div>
    <div class="panel-section top-questions" id="topQuestionsList">
      <!-- Top questions will be added here by JavaScript -->
    </div>
  </div>

  <script>
    // DOM Elements
    const chatContainer = document.getElementById('chatContainer');
    const messageInput = document.getElementById('messageInput');
    const sendBtn = document.getElementById('sendBtn');
    const micBtn = document.getElementById('micBtn');
    const fileBtn = document.getElementById('fileBtn');
    const imageBtn = document.getElementById('imageBtn');
    const themeToggle = document.getElementById('themeToggle');
    const languageSelect = document.getElementById('languageSelect');
    const menuBtn = document.getElementById('menuBtn');
    const settingsPanel = document.getElementById('settingsPanel');
    const notificationsPanel = document.getElementById('notificationsPanel');
    const aboutDeveloperPanel = document.getElementById('aboutDeveloperPanel');
    const aboutSchoolPanel = document.getElementById('aboutSchoolPanel');
    const termsPanel = document.getElementById('termsPanel');
    const topQuestionsPanel = document.getElementById('topQuestionsPanel');
    const closeSettings = document.getElementById('closeSettings');
    const closeNotifications = document.getElementById('closeNotifications');
    const closeAboutDeveloper = document.getElementById('closeAboutDeveloper');
    const closeAboutSchool = document.getElementById('closeAboutSchool');
    const closeTerms = document.getElementById('closeTerms');
    const closeTopQuestions = document.getElementById('closeTopQuestions');
    const notificationBadge = document.getElementById('notificationBadge');
    const notificationCount = document.getElementById('notificationCount');
    const maintenanceScreen = document.getElementById('maintenanceScreen');
    const settingsNav = document.getElementById('settingsNav');
    const topQuestionsNav = document.getElementById('topQuestionsNav');
    const chatsNav = document.getElementById('chatsNav');

    // Mock data
    const topQuestions = [
      "What is photosynthesis?",
      "Explain Newton's laws of motion",
      "What are the parts of a plant?",
      "How to solve quadratic equations?",
      "What is the water cycle?",
      "Explain the human digestive system",
      "What are fractions in mathematics?",
      "What is the solar system?",
      "How does electricity work?",
      "What are the states of matter?"
    ];

    const notifications = [
      { title: "New Feature", message: "Image generation is now available!", time: "2 hours ago" },
      { title: "Maintenance", message: "Scheduled maintenance on Sunday at 2 AM", time: "1 day ago" },
      { title: "Update", message: "New study materials added for Class 6", time: "3 days ago" }
    ];

    // State
    let isMaintenanceMode = false;
    let notificationCountValue = 0;
    let chatHistory = [];
    let currentChatId = null;

    // Initialize app
    function initApp() {
      // Check for maintenance mode (would normally come from Firebase)
      checkMaintenanceMode();
      
      // Show greeting message
      showGreetingMessage();
      
      // Load top questions
      loadTopQuestions();
      
      // Load notifications
      loadNotifications();
      
      // Request notification permission
      requestNotificationPermission();
      
      // Event listeners
      setupEventListeners();
      
      // Set theme from localStorage or system preference
      setInitialTheme();
      
      // Set language
      setInitialLanguage();
    }

    // Show greeting message based on time of day
    function showGreetingMessage() {
      const hour = new Date().getHours();
      let greeting = "";
      let icon = "";
      
      if (hour >= 5 && hour < 12) {
        greeting = "Good Morning ✨";
        icon = "wb_sunny";
      } else if (hour >= 12 && hour < 17) {
        greeting = "Good Afternoon ✨";
        icon = "brightness_5";
      } else if (hour >= 17 && hour < 21) {
        greeting = "Good Evening ✨";
        icon = "brightness_3";
      } else {
        greeting = "Good Night ✨";
        icon = "bedtime";
      }
      
      const greetingMessage = document.createElement('div');
      greetingMessage.className = 'greeting-message';
      greetingMessage.innerHTML = `
        <span class="material-icons greeting-icon">${icon}</span>
        <h3 class="greeting-text">${greeting}</h3>
        <p class="greeting-subtext">Ask me anything about study</p>
      `;
      
      chatContainer.appendChild(greetingMessage);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    // Load top questions
    function loadTopQuestions() {
      const topQuestionsList = document.getElementById('topQuestionsList');
      topQuestionsList.innerHTML = '';
      
      topQuestions.forEach((question, index) => {
        const questionElement = document.createElement('div');
        questionElement.className = 'top-question';
        questionElement.textContent = `${index + 1}. ${question}`;
        questionElement.addEventListener('click', () => {
          sendMessage(question);
          closePanel(topQuestionsPanel);
        });
        topQuestionsList.appendChild(questionElement);
      });
    }

    // Load notifications
    function loadNotifications() {
      const notificationsList = document.getElementById('notificationsList');
      notificationsList.innerHTML = '';
      
      notifications.forEach(notification => {
        const notificationElement = document.createElement('div');
        notificationElement.className = 'setting-item';
        notificationElement.innerHTML = `
          <div>
            <strong>${notification.title}</strong>
            <p>${notification.message}</p>
            <small>${notification.time}</small>
          </div>
        `;
        notificationsList.appendChild(notificationElement);
      });
      
      // Set notification count
      notificationCountValue = notifications.length;
      notificationCount.textContent = notificationCountValue;
    }

    // Request browser notification permission
    function requestNotificationPermission() {
      if ('Notification' in window) {
        Notification.requestPermission();
      }
    }

    // Show browser notification
    function showBrowserNotification(title, message) {
      if ('Notification' in window && Notification.permission === 'granted') {
        new Notification(title, {
          body: message,
          icon: 'https://placehold.co/64x64/4338ca/white?text=MAI'
        });
      }
    }

    // Check maintenance mode (would normally check Firebase)
    function checkMaintenanceMode() {
      // This would normally check a Firebase value
      if (isMaintenanceMode) {
        maintenanceScreen.style.display = 'flex';
      } else {
        maintenanceScreen.style.display = 'none';
      }
    }

    // Send message
    function sendMessage(text) {
      if (!text.trim()) return;
      
      // Add user message
      addMessage(text, 'user');
      
      // Clear input
      messageInput.value = '';
      
      // Show typing indicator
      showTypingIndicator();
      
      // Simulate AI response (would normally call Gemini API)
      setTimeout(() => {
        // Hide typing indicator
        const typingIndicator = document.querySelector('.typing-indicator');
        if (typingIndicator) {
          typingIndicator.remove();
        }
        
        // Generate AI response
        const aiResponse = generateAIResponse(text);
        addMessage(aiResponse, 'ai');
        
        // Show related questions
        showRelatedQuestions(text);
        
        // Auto-rename chat (would normally use AI to generate title)
        autoRenameChat(text);
      }, 2000);
    }

    // Generate AI response (mock)
    function generateAIResponse(userMessage) {
      // This would normally call the Gemini API
      const responses = [
        "That's a great question! Let me explain this concept in detail for you.",
        "I understand what you're asking. Here's a comprehensive answer to help you learn better.",
        "This is an important topic in your curriculum. Let me break it down step by step.",
        "I'm happy to help you with this! Here's what you need to know about this subject.",
        "Excellent question! This concept is fundamental to understanding more advanced topics."
      ];
      
      return responses[Math.floor(Math.random() * responses.length)] + " " + userMessage.split(' ').slice(0, 5).join(' ') + "... (This is a simulated response. In the real app, this would come from the Gemini API.)";
    }

    // Add message to chat
    function addMessage(text, sender) {
      const messageElement = document.createElement('div');
      messageElement.className = `message ${sender}-message`;
      messageElement.textContent = text;
      
      if (sender === 'ai') {
        // Add message options for AI messages
        const optionsElement = document.createElement('div');
        optionsElement.className = 'message-options';
        optionsElement.innerHTML = `
          <div class="message-option" onclick="regenerateResponse(this)">
            <span class="material-icons">refresh</span>
            <span>Regenerate</span>
          </div>
          <div class="message-option" onclick="copyToClipboard(this)">
            <span class="material-icons">content_copy</span>
            <span>Copy</span>
          </div>
          <div class="message-option" onclick="likeMessage(this)">
            <span class="material-icons">thumb_up</span>
            <span>Like</span>
          </div>
          <div class="message-option" onclick="dislikeMessage(this)">
            <span class="material-icons">thumb_down</span>
            <span>Dislike</span>
          </div>
          <div class="message-option" onclick="shareMessage(this)">
            <span class="material-icons">share</span>
            <span>Share</span>
          </div>
        `;
        messageElement.appendChild(optionsElement);
      }
      
      chatContainer.appendChild(messageElement);
      chatContainer.scrollTop = chatContainer.scrollHeight;
      
      // Add to chat history
      chatHistory.push({
        id: Date.now(),
        text: text,
        sender: sender,
        timestamp: new Date()
      });
    }

    // Show typing indicator
    function showTypingIndicator() {
      const typingIndicator = document.createElement('div');
      typingIndicator.className = 'typing-indicator';
      typingIndicator.innerHTML = `
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
      `;
      chatContainer.appendChild(typingIndicator);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    // Show related questions
    function showRelatedQuestions(topic) {
      const relatedQuestions = document.createElement('div');
      relatedQuestions.className = 'related-questions';
      relatedQuestions.innerHTML = `
        <h4 class="related-title">Related Questions</h4>
        <div class="related-question">What is the basic concept of ${topic.split(' ')[0]}?</div>
        <div class="related-question">How does ${topic.split(' ')[0]} work in real life?</div>
        <div class="related-question">What are examples of ${topic.split(' ')[0]}?</div>
      `;
      
      // Add click handlers to related questions
      const questionElements = relatedQuestions.querySelectorAll('.related-question');
      questionElements.forEach(question => {
        question.addEventListener('click', () => {
          sendMessage(question.textContent);
        });
      });
      
      chatContainer.appendChild(relatedQuestions);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    // Auto-rename chat
    function autoRenameChat(firstMessage) {
      // This would normally use AI to generate a title
      const words = firstMessage.split(' ');
      const title = words.slice(0, 3).join(' ') + (words.length > 3 ? '...' : '');
      console.log('Chat auto-renamed to:', title);
    }

    // Regenerate response
    function regenerateResponse(element) {
      const messageElement = element.closest('.message');
      const originalText = messageElement.childNodes[0].textContent;
      
      // Show typing indicator
      const optionsElement = messageElement.querySelector('.message-options');
      messageElement.removeChild(optionsElement);
      
      const typingIndicator = document.createElement('div');
      typingIndicator.className = 'typing-indicator';
      typingIndicator.innerHTML = `
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
      `;
      messageElement.appendChild(typingIndicator);
      
      // Simulate regeneration
      setTimeout(() => {
        typingIndicator.remove();
        messageElement.childNodes[0].textContent = "Here's a regenerated response: " + originalText;
        messageElement.appendChild(optionsElement);
      }, 1500);
    }

    // Copy to clipboard
    function copyToClipboard(element) {
      const messageElement = element.closest('.message');
      const text = messageElement.childNodes[0].textContent;
      
      navigator.clipboard.writeText(text).then(() => {
        alert('Copied to clipboard!');
      }).catch(err => {
        console.error('Could not copy text: ', err);
      });
    }

    // Like message
    function likeMessage(element) {
      element.innerHTML = '<span class="material-icons">thumb_up</span><span>Liked</span>';
      element.style.backgroundColor = 'rgba(16, 185, 129, 0.2)';
    }

    // Dislike message
    function dislikeMessage(element) {
      element.innerHTML = '<span class="material-icons">thumb_down</span><span>Disliked</span>';
      element.style.backgroundColor = 'rgba(239, 68, 68, 0.2)';
    }

    // Share message
    function shareMessage(element) {
      const messageElement = element.closest('.message');
      const text = messageElement.childNodes[0].textContent;
      
      if (navigator.share) {
        navigator.share({
          title: 'Milli AI Response',
          text: text,
          url: window.location.href
        }).catch(err => {
          console.error('Error sharing:', err);
        });
      } else {
        alert('Share this message: ' + text);
      }
    }

    // Toggle theme
    function toggleTheme() {
      document.body.classList.toggle('dark-theme');
      // Save to localStorage
      localStorage.setItem('darkTheme', document.body.classList.contains('dark-theme'));
    }

    // Set initial theme
    function setInitialTheme() {
      const savedTheme = localStorage.getItem('darkTheme');
      if (savedTheme === 'true') {
        document.body.classList.add('dark-theme');
        themeToggle.checked = true;
      } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark-theme');
        themeToggle.checked = true;
      }
    }

    // Set initial language
    function setInitialLanguage() {
      const savedLanguage = localStorage.getItem('language');
      if (savedLanguage) {
        languageSelect.value = savedLanguage;
      }
    }

    // Open panel
    function openPanel(panel) {
      panel.classList.add('active');
    }

    // Close panel
    function closePanel(panel) {
      panel.classList.remove('active');
    }

    // Setup event listeners
    function setupEventListeners() {
      // Send message
      sendBtn.addEventListener('click', () => {
        sendMessage(messageInput.value);
      });
      
      messageInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          sendMessage(messageInput.value);
        }
      });
      
      // Mic button (would implement speech recognition)
      micBtn.addEventListener('click', () => {
        alert('Voice input feature would be implemented here');
      });
      
      // File upload button
      fileBtn.addEventListener('click', () => {
        alert('File upload feature would be implemented here');
      });
      
      // Image generation button
      imageBtn.addEventListener('click', () => {
        alert('Image generation using Stable Horde API would be implemented here');
      });
      
      // Theme toggle
      themeToggle.addEventListener('change', toggleTheme);
      
      // Language change
      languageSelect.addEventListener('change', () => {
        localStorage.setItem('language', languageSelect.value);
        alert(`Language changed to ${languageSelect.value === 'en' ? 'English' : 'Hindi'}`);
      });
      
      // Menu button
      menuBtn.addEventListener('click', () => {
        openPanel(settingsPanel);
      });
      
      // Navigation buttons
      settingsNav.addEventListener('click', () => {
        openPanel(settingsPanel);
      });
      
      topQuestionsNav.addEventListener('click', () => {
        openPanel(topQuestionsPanel);
      });
      
      // Close buttons
      closeSettings.addEventListener('click', () => {
        closePanel(settingsPanel);
      });
      
      closeNotifications.addEventListener('click', () => {
        closePanel(notificationsPanel);
      });
      
      closeAboutDeveloper.addEventListener('click', () => {
        closePanel(aboutDeveloperPanel);
      });
      
      closeAboutSchool.addEventListener('click', () => {
        closePanel(aboutSchoolPanel);
      });
      
      closeTerms.addEventListener('click', () => {
        closePanel(termsPanel);
      });
      
      closeTopQuestions.addEventListener('click', () => {
        closePanel(topQuestionsPanel);
      });
      
      // Settings panel items
      const aboutDeveloperItem = document.querySelector('.setting-item:nth-child(1)');
      aboutDeveloperItem.addEventListener('click', () => {
        closePanel(settingsPanel);
        setTimeout(() => openPanel(aboutDeveloperPanel), 300);
      });
      
      const aboutSchoolItem = document.querySelector('.setting-item:nth-child(2)');
      aboutSchoolItem.addEventListener('click', () => {
        closePanel(settingsPanel);
        setTimeout(() => openPanel(aboutSchoolPanel), 300);
      });
      
      const termsItem = document.querySelector('.setting-item:nth-child(3)');
      termsItem.addEventListener('click', () => {
        closePanel(settingsPanel);
        setTimeout(() => openPanel(termsPanel), 300);
      });
      
      // Notification badge
      notificationBadge.addEventListener('click', () => {
        openPanel(notificationsPanel);
        // Reset notification count
        notificationCountValue = 0;
        notificationCount.textContent = notificationCountValue;
      });
      
      // Logout
      const logoutItem = document.querySelector('.setting-item:last-child');
      logoutItem.addEventListener('click', () => {
        if (confirm('Are you sure you want to logout?')) {
          alert('Logout functionality would be implemented here with Firebase Auth');
        }
      });
    }

    // Initialize the app when page loads
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>
