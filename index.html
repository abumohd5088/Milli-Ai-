<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Milli AI School Assistant</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4285f4;
            --secondary-color: #34a853;
            --background-light: #f5f5f5;
            --background-dark: #121212;
            --card-light: #ffffff;
            --card-dark: #1e1e1e;
            --text-light: #333333;
            --text-dark: #e0e0e0;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-light);
            color: var(--text-light);
            transition: var(--transition);
        }

        body.dark-mode {
            background-color: var(--background-dark);
            color: var(--text-dark);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background-color: var(--card-light);
            box-shadow: var(--shadow);
            border-radius: 12px;
            margin-bottom: 20px;
            transition: var(--transition);
        }

        body.dark-mode header {
            background-color: var(--card-dark);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
            font-size: 1.5rem;
        }

        .logo i {
            color: var(--primary-color);
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .icon-button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 24px;
            color: var(--text-light);
            transition: var(--transition);
        }

        body.dark-mode .icon-button {
            color: var(--text-dark);
        }

        .icon-button:hover {
            color: var(--primary-color);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .chat-container {
            background-color: var(--card-light);
            border-radius: 12px;
            box-shadow: var(--shadow);
            padding: 20px;
            height: 70vh;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
        }

        body.dark-mode .chat-container {
            background-color: var(--card-dark);
        }

        .welcome-section {
            text-align: center;
            padding: 40px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

        .welcome-icon {
            font-size: 48px;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .welcome-text {
            font-size: 1.5rem;
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .start-chat-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 24px;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .start-chat-btn:hover {
            background-color: #3367d6;
            transform: translateY(-2px);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
            display: none;
        }

        .message {
            margin-bottom: 15px;
            padding: 12px 16px;
            border-radius: 18px;
            max-width: 80%;
            word-wrap: break-word;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            background-color: var(--primary-color);
            color: white;
            align-self: flex-end;
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }

        .ai-message {
            background-color: var(--background-light);
            color: var(--text-light);
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }

        body.dark-mode .ai-message {
            background-color: #2a2a2a;
            color: var(--text-dark);
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
            padding: 15px 0;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            margin-top: auto;
        }

        body.dark-mode .chat-input-container {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .suggestions-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 10px 0;
            margin-bottom: 10px;
        }

        .suggestion-chip {
            background-color: rgba(66, 133, 244, 0.1);
            color: var(--primary-color);
            border: none;
            padding: 8px 16px;
            border-radius: 16px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
        }

        body.dark-mode .suggestion-chip {
            background-color: rgba(66, 133, 244, 0.2);
        }

        .suggestion-chip:hover {
            background-color: rgba(66, 133, 244, 0.2);
        }

        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: 24px;
            font-size: 1rem;
            outline: none;
            transition: var(--transition);
        }

        body.dark-mode .chat-input {
            background-color: #2a2a2a;
            color: var(--text-dark);
            border-color: #444;
        }

        .chat-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
        }

        .send-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .send-button:hover {
            background-color: #3367d6;
        }

        .input-tools {
            display: flex;
            gap: 8px;
        }

        .tool-button {
            background-color: transparent;
            border: 1px solid #ddd;
            color: var(--text-light);
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        body.dark-mode .tool-button {
            border-color: #444;
            color: var(--text-dark);
        }

        .tool-button:hover {
            background-color: rgba(66, 133, 244, 0.1);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .sidebar {
            background-color: var(--card-light);
            border-radius: 12px;
            box-shadow: var(--shadow);
            padding: 20px;
            height: fit-content;
            transition: var(--transition);
        }

        body.dark-mode .sidebar {
            background-color: var(--card-dark);
        }

        .sidebar-section {
            margin-bottom: 30px;
        }

        .sidebar-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .notification-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            background-color: rgba(0, 0, 0, 0.05);
            transition: var(--transition);
            cursor: pointer;
        }

        body.dark-mode .notification-item {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .notification-item:hover {
            background-color: rgba(66, 133, 244, 0.1);
        }

        .notification-icon {
            font-size: 20px;
            color: var(--primary-color);
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .notification-time {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .question-item {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            background-color: rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: var(--transition);
        }

        body.dark-mode .question-item {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .question-item:hover {
            background-color: rgba(66, 133, 244, 0.1);
        }

        .floating-menu {
            position: absolute;
            background-color: var(--card-light);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 8px 0;
            min-width: 160px;
            z-index: 1000;
            display: none;
            transition: var(--transition);
        }

        body.dark-mode .floating-menu {
            background-color: var(--card-dark);
        }

        .menu-item {
            padding: 12px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: var(--transition);
        }

        .menu-item:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        body.dark-mode .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .menu-icon {
            font-size: 18px;
            color: var(--text-light);
        }

        body.dark-mode .menu-icon {
            color: var(--text-dark);
        }

        .image-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .image-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .image-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            display: block;
        }

        .image-actions {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px;
            display: flex;
            justify-content: space-between;
            opacity: 0;
            transition: var(--transition);
        }

        .image-item:hover .image-actions {
            opacity: 1;
        }

        .download-btn, .delete-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 16px;
        }

        .maintenance-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 80vh;
            text-align: center;
            padding: 20px;
        }

        .maintenance-icon {
            font-size: 64px;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .maintenance-title {
            font-size: 2rem;
            margin-bottom: 20px;
        }

        .maintenance-message {
            font-size: 1.2rem;
            max-width: 600px;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .settings-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .settings-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .settings-content {
            background-color: var(--card-light);
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        body.dark-mode .settings-content {
            background-color: var(--card-dark);
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        body.dark-mode .settings-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .settings-title {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .close-settings {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-light);
            transition: var(--transition);
        }

        body.dark-mode .close-settings {
            color: var(--text-dark);
        }

        .close-settings:hover {
            color: var(--primary-color);
        }

        .settings-section {
            margin-bottom: 30px;
        }

        .settings-section-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        body.dark-mode .settings-section-title {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        body.dark-mode .settings-item {
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .settings-label {
            font-size: 1rem;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .info-item {
            margin-bottom: 15px;
        }

        .info-label {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .info-value {
            word-wrap: break-word;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--primary-color);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 3000;
            transform: translateY(100px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast-icon {
            font-size: 20px;
        }

        /* Chat list styles */
        .chat-list {
            margin-bottom: 20px;
            max-height: 200px;
            overflow-y: auto;
        }

        .chat-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            background-color: rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: var(--transition);
        }

        body.dark-mode .chat-item {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .chat-item:hover {
            background-color: rgba(66, 133, 244, 0.1);
        }

        .chat-item.active {
            background-color: rgba(66, 133, 244, 0.2);
        }

        .chat-name {
            flex: 1;
            font-weight: 500;
        }

        .chat-actions {
            display: flex;
            gap: 8px;
        }

        .chat-action-btn {
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            font-size: 16px;
            transition: var(--transition);
        }

        body.dark-mode .chat-action-btn {
            color: var(--text-dark);
        }

        .chat-action-btn:hover {
            color: var(--primary-color);
        }

        /* Loading animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(66, 133, 244, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <span class="material-icons">school</span>
                <span>Milli AI School Assistant</span>
            </div>
            <div class="header-actions">
                <button class="icon-button" id="theme-toggle">
                    <span class="material-icons">brightness_4</span>
                </button>
                <button class="icon-button" id="settings-button">
                    <span class="material-icons">settings</span>
                </button>
                <button class="icon-button" id="menu-button">
                    <span class="material-icons">more_vert</span>
                </button>
            </div>
        </header>

        <div class="main-content">
            <div class="chat-container">
                <div id="welcome-section" class="welcome-section">
                    <span class="material-icons welcome-icon">smart_toy</span>
                    <h2 class="welcome-text" id="greeting-text">Good Morning. I am Milli AI. Ask me anything about study...</h2>
                    <button class="start-chat-btn" id="start-chat-btn">
                        <span class="material-icons">chat</span>
                        Start New Chat
                    </button>
                </div>

                <div id="maintenance-page" class="maintenance-page" style="display: none;">
                    <span class="material-icons maintenance-icon">construction</span>
                    <h2 class="maintenance-title">Maintenance Mode</h2>
                    <p class="maintenance-message" id="maintenance-message">We're currently performing maintenance on the system. Please check back later. Thank you for your patience!</p>
                </div>

                <div id="chat-messages" class="chat-messages">
                    <!-- Messages will be added here dynamically -->
                </div>

                <div class="suggestions-container" id="suggestions-container" style="display: none;">
                    <!-- Suggestions will be added here dynamically -->
                </div>

                <div class="chat-input-container" id="chat-input-container" style="display: none;">
                    <div class="input-tools">
                        <button class="tool-button" id="upload-file">
                            <span class="material-icons">attach_file</span>
                        </button>
                        <button class="tool-button" id="upload-image">
                            <span class="material-icons">image</span>
                        </button>
                        <button class="tool-button" id="voice-input">
                            <span class="material-icons">mic</span>
                        </button>
                        <button class="tool-button" id="generate-image">
                            <span class="material-icons">auto_awesome</span>
                        </button>
                    </div>
                    <input type="text" class="chat-input" id="chat-input" placeholder="Type your question here...">
                    <button class="send-button" id="send-button">
                        <span class="material-icons">send</span>
                    </button>
                </div>
            </div>

            <div class="sidebar">
                <div class="sidebar-section">
                    <h3 class="sidebar-title">
                        <span class="material-icons">chat</span>
                        Recent Chats
                    </h3>
                    <div class="chat-list" id="chat-list">
                        <!-- Chat items will be added here dynamically -->
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3 class="sidebar-title">
                        <span class="material-icons">notifications</span>
                        Notifications
                    </h3>
                    <div id="notifications-container">
                        <!-- Notifications will be added here dynamically -->
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3 class="sidebar-title">
                        <span class="material-icons">help</span>
                        Top 10 Questions
                    </h3>
                    <div id="top-questions-container">
                        <!-- Top questions will be added here dynamically -->
                    </div>
                </div>
            </div>
        </div>

        <div class="floating-menu" id="floating-menu">
            <div class="menu-item" id="rename-chat">
                <span class="material-icons menu-icon">edit</span>
                <span>Rename Chat</span>
            </div>
            <div class="menu-item" id="delete-chat">
                <span class="material-icons menu-icon">delete</span>
                <span>Delete Chat</span>
            </div>
        </div>

        <div class="settings-modal" id="settings-modal">
            <div class="settings-content">
                <div class="settings-header">
                    <h2 class="settings-title">Settings</h2>
                    <button class="close-settings" id="close-settings">
                        <span class="material-icons">close</span>
                    </button>
                </div>

                <div class="settings-section">
                    <h3 class="settings-section-title">Appearance</h3>
                    <div class="settings-item">
                        <span class="settings-label">Dark Mode</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="dark-mode-toggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="settings-section-title">About Developer</h3>
                    <div class="info-item">
                        <div class="info-label">Name</div>
                        <div class="info-value">Abutalha</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Class</div>
                        <div class="info-value">6, Milli Karwaan Public School Balrampur</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Contact</div>
                        <div class="info-value">9839469669</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Note</div>
                        <div class="info-value">Young developer with passion for AI & innovation</div>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="settings-section-title">About School</h3>
                    <div class="info-item">
                        <div class="info-label">School</div>
                        <div class="info-value">Milli Karwaan Public School Balrampur (MKPS)</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Address</div>
                        <div class="info-value">Baluha Police Chowki, Balrampur, Uttar Pradesh</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Contact</div>
                        <div class="info-value">9758919151</div>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="settings-section-title">Other Settings</h3>
                    <div class="settings-item">
                        <span class="settings-label">Language</span>
                        <select id="language-select">
                            <option value="en">English</option>
                            <option value="hi">Hindi</option>
                        </select>
                    </div>
                    <div class="settings-item">
                        <a href="#" class="settings-label">Terms & Conditions</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="toast" id="toast">
            <span class="material-icons toast-icon">notifications</span>
            <span id="toast-message">Notification message</span>
        </div>
    </div>

    <script>
        // Initialize Firebase (mock implementation since we can't use actual Firebase)
        const firebaseConfig = {
            apiKey: "your-api-key",
            authDomain: "your-project.firebaseapp.com",
            projectId: "your-project",
            storageBucket: "your-project.appspot.com",
            messagingSenderId: "your-sender-id",
            appId: "your-app-id"
        };

        // Mock Firebase services
        const mockFirebase = {
            auth: {
                currentUser: { uid: "mock-user-id" },
                onAuthStateChanged: (callback) => {
                    setTimeout(() => callback(mockFirebase.auth.currentUser), 1000);
                }
            },
            firestore: {
                collection: (name) => ({
                    doc: (id) => ({
                        get: async () => ({
                            exists: true,
                            data: () => {
                                if (name === "system" && id === "maintenance") {
                                    return { enabled: false, message: "Maintenance in progress" };
                                } else if (name === "stats") {
                                    return {
                                        topQuestions: [
                                            "What is photosynthesis?",
                                            "How to solve quadratic equations?",
                                            "What are the laws of motion?",
                                            "Explain the water cycle",
                                            "What is the periodic table?",
                                            "How to write a good essay?",
                                            "What are prime numbers?",
                                            "Explain Newton's laws",
                                            "What is cellular respiration?",
                                            "How to balance chemical equations?"
                                        ]
                                    };
                                }
                                return {};
                            }
                        }),
                        set: async (data) => {
                            console.log(`Setting ${name}/${id}:`, data);
                        },
                        update: async (data) => {
                            console.log(`Updating ${name}/${id}:`, data);
                        }
                    }),
                    where: (field, op, value) => ({
                        get: async () => ({
                            docs: []
                        })
                    }),
                    add: async (data) => {
                        console.log(`Adding to ${name}:`, data);
                        return { id: "mock-doc-id" };
                    }
                })
            }
        };

        // Mock data
        let currentChatId = null;
        let chats = [];
        let notifications = [
            { id: 1, title: "New Assignment", message: "Math homework due tomorrow", time: "2 hours ago", read: false },
            { id: 2, title: "School Event", message: "Annual day celebration next week", time: "1 day ago", read: false },
            { id: 3, title: "Reminder", message: "Parent-teacher meeting scheduled", time: "3 days ago", read: true }
        ];

        // DOM Elements
        const welcomeSection = document.getElementById('welcome-section');
        const maintenancePage = document.getElementById('maintenance-page');
        const chatMessages = document.getElementById('chat-messages');
        const chatInputContainer = document.getElementById('chat-input-container');
        const suggestionsContainer = document.getElementById('suggestions-container');
        const chatInput = document.getElementById('chat-input');
        const sendButton = document.getElementById('send-button');
        const startChatBtn = document.getElementById('start-chat-btn');
        const greetingText = document.getElementById('greeting-text');
        const chatList = document.getElementById('chat-list');
        const notificationsContainer = document.getElementById('notifications-container');
        const topQuestionsContainer = document.getElementById('top-questions-container');
        const themeToggle = document.getElementById('theme-toggle');
        const settingsButton = document.getElementById('settings-button');
        const menuButton = document.getElementById('menu-button');
        const floatingMenu = document.getElementById('floating-menu');
        const renameChatBtn = document.getElementById('rename-chat');
        const deleteChatBtn = document.getElementById('delete-chat');
        const settingsModal = document.getElementById('settings-modal');
        const closeSettings = document.getElementById('close-settings');
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const languageSelect = document.getElementById('language-select');
        const uploadFileBtn = document.getElementById('upload-file');
        const uploadImageBtn = document.getElementById('upload-image');
        const voiceInputBtn = document.getElementById('voice-input');
        const generateImageBtn = document.getElementById('generate-image');
        const maintenanceMessage = document.getElementById('maintenance-message');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toast-message');

        // Initialize the app
        document.addEventListener('DOMContentLoaded', async () => {
            // Check maintenance mode
            await checkMaintenanceMode();
            
            // Load existing chats
            loadChats();
            
            // Load notifications
            loadNotifications();
            
            // Load top questions
            loadTopQuestions();
            
            // Set greeting based on time
            setGreeting();
            
            // Event listeners
            startChatBtn.addEventListener('click', startNewChat);
            sendButton.addEventListener('click', sendMessage);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });
            
            // Tool buttons
            uploadFileBtn.addEventListener('click', () => showToast('File upload feature coming soon!'));
            uploadImageBtn.addEventListener('click', () => showToast('Image upload feature coming soon!'));
            voiceInputBtn.addEventListener('click', () => showToast('Voice input feature coming soon!'));
            generateImageBtn.addEventListener('click', generateImage);
            
            // Settings and theme
            settingsButton.addEventListener('click', () => {
                settingsModal.classList.add('active');
            });
            
            closeSettings.addEventListener('click', () => {
                settingsModal.classList.remove('active');
            });
            
            darkModeToggle.addEventListener('change', toggleDarkMode);
            
            // Initialize dark mode from localStorage if available
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
                darkModeToggle.checked = true;
            }
            
            // Floating menu
            menuButton.addEventListener('click', (e) => {
                const rect = menuButton.getBoundingClientRect();
                floatingMenu.style.display = 'block';
                floatingMenu.style.top = `${rect.bottom + window.scrollY}px`;
                floatingMenu.style.left = `${rect.left + window.scrollX}px`;
            });
            
            renameChatBtn.addEventListener('click', renameCurrentChat);
            deleteChatBtn.addEventListener('click', deleteCurrentChat);
            
            // Close floating menu when clicking outside
            document.addEventListener('click', (e) => {
                if (!floatingMenu.contains(e.target) && e.target !== menuButton) {
                    floatingMenu.style.display = 'none';
                }
            });
            
            // Language change
            languageSelect.addEventListener('change', (e) => {
                showToast(`Language changed to ${e.target.value === 'en' ? 'English' : 'Hindi'}`);
            });
        });

        // Check maintenance mode
        async function checkMaintenanceMode() {
            try {
                const systemRef = mockFirebase.firestore.collection('system').doc('maintenance');
                const doc = await systemRef.get();
                if (doc.exists) {
                    const data = doc.data();
                    if (data.enabled) {
                        maintenancePage.style.display = 'flex';
                        welcomeSection.style.display = 'none';
                        chatInputContainer.style.display = 'none';
                        maintenanceMessage.textContent = data.message || 'We are currently performing maintenance. Please check back later.';
                        return true;
                    }
                }
                return false;
            } catch (error) {
                console.error('Error checking maintenance mode:', error);
                return false;
            }
        }

        // Set greeting based on time
        function setGreeting() {
            const hour = new Date().getHours();
            let greeting = '';
            
            if (hour < 12) {
                greeting = 'Good Morning';
            } else if (hour < 17) {
                greeting = 'Good Afternoon';
            } else {
                greeting = 'Good Evening';
            }
            
            greetingText.textContent = `${greeting}. I am Milli AI. Ask me anything about study...`;
        }

        // Start new chat
        function startNewChat() {
            welcomeSection.style.display = 'none';
            chatMessages.style.display = 'block';
            chatInputContainer.style.display = 'flex';
            suggestionsContainer.style.display = 'block';
            
            // Create new chat
            const newChat = {
                id: 'chat-' + Date.now(),
                name: 'New Chat',
                messages: [],
                createdAt: new Date()
            };
            
            chats.push(newChat);
            currentChatId = newChat.id;
            loadChatList();
            loadSuggestions();
            
            // Auto-rename chat using AI (mock)
            setTimeout(() => {
                autoRenameChat(newChat.id);
            }, 3000);
        }

        // Send message
        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message) return;
            
            // Add user message
            addMessageToChat(message, 'user');
            chatInput.value = '';
            
            // Show loading indicator
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message ai-message';
            loadingDiv.innerHTML = '<div class="loading"></div> Milli AI is thinking...';
            chatMessages.appendChild(loadingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Get AI response (mock)
            setTimeout(async () => {
                chatMessages.removeChild(loadingDiv);
                
                // Mock AI response based on question
                let aiResponse = await getAIResponse(message);
                addMessageToChat(aiResponse, 'ai');
                
                // Auto-rename chat if it's still "New Chat"
                const currentChat = chats.find(chat => chat.id === currentChatId);
                if (currentChat && currentChat.name === 'New Chat') {
                    autoRenameChat(currentChatId);
                }
            }, 1500);
        }

        // Add message to chat
        function addMessageToChat(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            messageDiv.textContent = text;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Save message to current chat
            if (currentChatId) {
                const currentChat = chats.find(chat => chat.id === currentChatId);
                if (currentChat) {
                    currentChat.messages.push({
                        text,
                        sender,
                        timestamp: new Date()
                    });
                }
            }
        }

        // Get AI response (mock implementation)
        async function getAIResponse(question) {
            // Mock responses based on question content
            const lowerQuestion = question.toLowerCase();
            
            if (lowerQuestion.includes('hello') || lowerQuestion.includes('hi')) {
                return "Hello! I'm Milli AI, your school assistant. How can I help you with your studies today?";
            } else if (lowerQuestion.includes('math') || lowerQuestion.includes('mathematics')) {
                return "Mathematics is the study of numbers, quantities, and shapes. I can help you with arithmetic, algebra, geometry, and more. What specific math problem do you need help with?";
            } else if (lowerQuestion.includes('science')) {
                return "Science is the systematic study of the structure and behavior of the physical and natural world. I can help you with biology, chemistry, physics, and earth science topics. What would you like to learn about?";
            } else if (lowerQuestion.includes('english')) {
                return "English language and literature involve reading, writing, speaking, and listening skills. I can help you with grammar, vocabulary, essay writing, and literature analysis. What do you need help with?";
            } else if (lowerQuestion.includes('history')) {
                return "History is the study of past events, particularly in human affairs. I can help you understand historical events, timelines, and their significance. Which historical period or event are you studying?";
            } else if (lowerQuestion.includes('thank')) {
                return "You're welcome! I'm here to help you with your studies. Feel free to ask me anything about your school subjects.";
            } else {
                return "That's an interesting question! As Milli AI, I'm designed to help you with your school studies. I can explain concepts, solve problems, and provide study tips. Could you be more specific about what you need help with?";
            }
        }

        // Auto-rename chat based on first message
        async function autoRenameChat(chatId) {
            const chat = chats.find(c => c.id === chatId);
            if (!chat || chat.messages.length === 0) return;
            
            // Get first user message
            const firstUserMessage = chat.messages.find(m => m.sender === 'user');
            if (!firstUserMessage) return;
            
            // Mock AI suggestion for chat name
            let suggestedName = firstUserMessage.text.substring(0, 30);
            if (firstUserMessage.text.length > 30) {
                suggestedName += '...';
            }
            
            // Clean up the name
            suggestedName = suggestedName.replace(/[^\w\s]/gi, '').trim();
            if (suggestedName.length > 0) {
                chat.name = suggestedName;
                loadChatList();
            }
        }

        // Load chat list
        function loadChatList() {
            chatList.innerHTML = '';
            
            chats.forEach(chat => {
                const chatItem = document.createElement('div');
                chatItem.className = `chat-item ${chat.id === currentChatId ? 'active' : ''}`;
                chatItem.dataset.chatId = chat.id;
                
                const chatName = document.createElement('div');
                chatName.className = 'chat-name';
                chatName.textContent = chat.name;
                
                const chatActions = document.createElement('div');
                chatActions.className = 'chat-actions';
                
                const renameBtn = document.createElement('button');
                renameBtn.className = 'chat-action-btn';
                renameBtn.innerHTML = '<span class="material-icons">edit</span>';
                renameBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    renameChat(chat.id);
                });
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'chat-action-btn';
                deleteBtn.innerHTML = '<span class="material-icons">delete</span>';
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteChat(chat.id);
                });
                
                chatActions.appendChild(renameBtn);
                chatActions.appendChild(deleteBtn);
                
                chatItem.appendChild(chatName);
                chatItem.appendChild(chatActions);
                
                chatItem.addEventListener('click', () => {
                    loadChat(chat.id);
                });
                
                chatList.appendChild(chatItem);
            });
        }

        // Load specific chat
        function loadChat(chatId) {
            const chat = chats.find(c => c.id === chatId);
            if (!chat) return;
            
            currentChatId = chatId;
            loadChatList(); // Update active state
            
            // Clear chat messages
            chatMessages.innerHTML = '';
            
            // Load messages
            chat.messages.forEach(message => {
                addMessageToChat(message.text, message.sender);
            });
            
            // Show chat interface
            welcomeSection.style.display = 'none';
            chatMessages.style.display = 'block';
            chatInputContainer.style.display = 'flex';
            suggestionsContainer.style.display = 'block';
        }

        // Rename chat
        function renameChat(chatId) {
            const chat = chats.find(c => c.id === chatId);
            if (!chat) return;
            
            const newName = prompt('Enter new chat name:', chat.name);
            if (newName && newName.trim()) {
                chat.name = newName.trim();
                loadChatList();
                showToast('Chat renamed successfully!');
            }
        }

        // Rename current chat
        function renameCurrentChat() {
            if (currentChatId) {
                renameChat(currentChatId);
            }
        }

        // Delete chat
        function deleteChat(chatId) {
            if (confirm('Are you sure you want to delete this chat? This action cannot be undone.')) {
                chats = chats.filter(chat => chat.id !== chatId);
                
                if (currentChatId === chatId) {
                    currentChatId = null;
                    chatMessages.innerHTML = '';
                    welcomeSection.style.display = 'flex';
                    chatMessages.style.display = 'none';
                    chatInputContainer.style.display = 'none';
                    suggestionsContainer.style.display = 'none';
                }
                
                loadChatList();
                showToast('Chat deleted successfully!');
            }
        }

        // Delete current chat
        function deleteCurrentChat() {
            if (currentChatId) {
                deleteChat(currentChatId);
            }
        }

        // Load suggestions
        function loadSuggestions() {
            suggestionsContainer.innerHTML = '';
            
            const suggestions = [
                'Summarize this topic',
                'Explain in simple terms',
                'Give me examples',
                'Generate practice questions',
                'Create a study plan',
                'Generate Image',
                'Compare and contrast',
                'Help me memorize this'
            ];
            
            suggestions.forEach(suggestion => {
                const chip = document.createElement('button');
                chip.className = 'suggestion-chip';
                chip.textContent = suggestion;
                chip.addEventListener('click', () => {
                    chatInput.value = suggestion;
                    chatInput.focus();
                });
                suggestionsContainer.appendChild(chip);
            });
        }

        // Load notifications
        function loadNotifications() {
            notificationsContainer.innerHTML = '';
            
            if (notifications.length === 0) {
                notificationsContainer.innerHTML = '<p>No notifications</p>';
                return;
            }
            
            notifications.forEach(notification => {
                const notifItem = document.createElement('div');
                notifItem.className = 'notification-item';
                notifItem.dataset.notifId = notification.id;
                
                const notifIcon = document.createElement('span');
                notifIcon.className = 'material-icons notification-icon';
                notifIcon.textContent = notification.read ? 'notifications' : 'notifications_active';
                
                const notifContent = document.createElement('div');
                notifContent.className = 'notification-content';
                
                const notifTitle = document.createElement('div');
                notifTitle.className = 'notification-title';
                notifTitle.textContent = notification.title;
                
                const notifTime = document.createElement('div');
                notifTime.className = 'notification-time';
                notifTime.textContent = notification.time;
                
                notifContent.appendChild(notifTitle);
                notifContent.appendChild(notifTime);
                
                notifItem.appendChild(notifIcon);
                notifItem.appendChild(notifContent);
                
                notifItem.addEventListener('click', () => {
                    // Mark as read
                    const notif = notifications.find(n => n.id === notification.id);
                    if (notif && !notif.read) {
                        notif.read = true;
                        notifIcon.textContent = 'notifications';
                    }
                    showToast(`Notification: ${notification.title}`);
                });
                
                notificationsContainer.appendChild(notifItem);
            });
        }

        // Load top questions
        async function loadTopQuestions() {
            try {
                const statsRef = mockFirebase.firestore.collection('stats').doc('topQuestions');
                const doc = await statsRef.get();
                if (doc.exists) {
                    const data = doc.data();
                    if (data.topQuestions && data.topQuestions.length > 0) {
                        topQuestionsContainer.innerHTML = '';
                        data.topQuestions.slice(0, 10).forEach((question, index) => {
                            const questionItem = document.createElement('div');
                            questionItem.className = 'question-item';
                            questionItem.innerHTML = `
                                <div class="question-rank" style="font-weight: bold; margin-right: 8px;">${index + 1}.</div>
                                <div class="question-text">${question}</div>
                            `;
                            questionItem.style.display = 'flex';
                            questionItem.style.alignItems = 'center';
                            
                            questionItem.addEventListener('click', () => {
                                if (!currentChatId) {
                                    startNewChat();
                                }
                                chatInput.value = question;
                                chatInput.focus();
                            });
                            
                            topQuestionsContainer.appendChild(questionItem);
                        });
                    }
                }
            } catch (error) {
                console.error('Error loading top questions:', error);
                topQuestionsContainer.innerHTML = '<p>Could not load top questions</p>';
            }
        }

        // Generate image using Stable Horde API (mock implementation)
        async function generateImage() {
            const prompt = chatInput.value.trim() || prompt('Enter image description:', 'A beautiful landscape');
            if (!prompt) return;
            
            showToast('Generating image... This may take a few moments.');
            
            // Show loading state
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message ai-message';
            loadingDiv.innerHTML = '<div class="loading"></div> Generating image...';
            chatMessages.appendChild(loadingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Mock API call
            setTimeout(() => {
                chatMessages.removeChild(loadingDiv);
                
                // Mock successful response
                const imageUrl = `https://placehold.co/512x512/4285f4/ffffff?text=${encodeURIComponent(prompt.substring(0, 20))}`;
                
                const imageMessage = document.createElement('div');
                imageMessage.className = 'message ai-message';
                
                const imageContainer = document.createElement('div');
                imageContainer.className = 'image-item';
                
                const img = document.createElement('img');
                img.src = imageUrl;
                img.alt = prompt;
                
                const imageActions = document.createElement('div');
                imageActions.className = 'image-actions';
                
                const downloadBtn = document.createElement('button');
                downloadBtn.className = 'download-btn';
                downloadBtn.innerHTML = '<span class="material-icons">download</span>';
                downloadBtn.addEventListener('click', () => {
                    // Mock download
                    showToast('Image downloaded!');
                });
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.innerHTML = '<span class="material-icons">delete</span>';
                deleteBtn.addEventListener('click', () => {
                    imageMessage.remove();
                    showToast('Image removed from chat.');
                });
                
                imageActions.appendChild(downloadBtn);
                imageActions.appendChild(deleteBtn);
                
                imageContainer.appendChild(img);
                imageContainer.appendChild(imageActions);
                imageMessage.appendChild(imageContainer);
                
                chatMessages.appendChild(imageMessage);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                showToast('Image generated successfully!');
            }, 3000);
        }

        // Toggle dark mode
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
            
            // Update icon
            const icon = themeToggle.querySelector('.material-icons');
            if (document.body.classList.contains('dark-mode')) {
                icon.textContent = 'brightness_7';
            } else {
                icon.textContent = 'brightness_4';
            }
        }

        // Show toast notification
        function showToast(message) {
            toastMessage.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Load existing chats from localStorage (mock)
        function loadChats() {
            const savedChats = localStorage.getItem('milliAiChats');
            if (savedChats) {
                try {
                    chats = JSON.parse(savedChats);
                    if (chats.length > 0) {
                        currentChatId = chats[0].id;
                        loadChatList();
                        loadChat(currentChatId);
                    }
                } catch (e) {
                    console.error('Error loading chats:', e);
                }
            }
        }

        // Save chats to localStorage (mock)
        function saveChats() {
            localStorage.setItem('milliAiChats', JSON.stringify(chats));
        }

        // Monitor chat changes and save
        const originalAddMessageToChat = addMessageToChat;
        addMessageToChat = function(text, sender) {
            originalAddMessageToChat(text, sender);
            saveChats();
        };

        // Override chat operations to save changes
        const originalRenameChat = renameChat;
        renameChat = function(chatId) {
            originalRenameChat(chatId);
            saveChats();
        };

        const originalDeleteChat = deleteChat;
        deleteChat = function(chatId) {
            originalDeleteChat(chatId);
            saveChats();
        };

        // Override startNewChat to save
        const originalStartNewChat = startNewChat;
        startNewChat = function() {
            originalStartNewChat();
            saveChats();
        };
    </script>
</body>
</html>
