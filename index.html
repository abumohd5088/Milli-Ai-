<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Milli Ai - Your Study Assistant</title>
    <link href="https://fonts.googleapis.com/css2?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4285f4;
            --secondary-color: #34a853;
            --background-color: #f8f9fa;
            --card-color: #ffffff;
            --text-color: #202124;
            --border-color: #dadce0;
            --hover-color: #f1f3f4;
            --shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            --transition: all 0.3s cubic-bezier(.25,.8,.25,1);
        }

        .dark-theme {
            --primary-color: #5a95f5;
            --secondary-color: #4caf50;
            --background-color: #121212;
            --card-color: #1e1e1e;
            --text-color: #e8eaed;
            --border-color: #3c4043;
            --hover-color: #2d2d2d;
            --shadow: 0 1px 3px rgba(0,0,0,0.3), 0 1px 2px rgba(0,0,0,0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            transition: var(--transition);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* System Banner */
        .system-banner {
            background-color: #ff6d00;
            color: white;
            padding: 8px 16px;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
            display: none;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .system-banner.active {
            display: flex;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background-color: var(--card-color);
            border-bottom: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            z-index: 10;
        }

        .header-title {
            font-size: 20px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-actions {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .icon-button {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-color);
            font-size: 24px;
            padding: 8px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .icon-button:hover {
            background-color: var(--hover-color);
        }

        .notification-badge {
            position: relative;
        }

        .badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background-color: #ea4335;
            color: white;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Main Content */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Sidebar - Chat List */
        .sidebar {
            width: 300px;
            background-color: var(--card-color);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .new-chat-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .new-chat-btn:hover {
            background-color: #3367d6;
        }

        .chat-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px 0;
        }

        .chat-item {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: var(--transition);
        }

        .chat-item:hover {
            background-color: var(--hover-color);
        }

        .chat-item.active {
            background-color: var(--hover-color);
            border-left: 3px solid var(--primary-color);
        }

        .chat-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .chat-info {
            flex: 1;
            min-width: 0;
        }

        .chat-title {
            font-weight: 500;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-preview {
            font-size: 12px;
            color: #5f6368;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-time {
            font-size: 12px;
            color: #5f6368;
            margin-left: 8px;
        }

        .chat-menu {
            position: relative;
        }

        .menu-dropdown {
            position: absolute;
            right: 0;
            top: 100%;
            background-color: var(--card-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: var(--shadow);
            min-width: 180px;
            z-index: 100;
            display: none;
        }

        .menu-item {
            padding: 12px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: var(--transition);
        }

        .menu-item:hover {
            background-color: var(--hover-color);
        }

        /* Chat Area */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-messages {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .message {
            display: flex;
            gap: 16px;
            max-width: 85%;
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-content {
            padding: 16px;
            border-radius: 18px;
            background-color: var(--hover-color);
            position: relative;
        }

        .message.user .message-content {
            background-color: var(--primary-color);
            color: white;
        }

        .message-ai .message-content {
            background-color: var(--card-color);
            border: 1px solid var(--border-color);
        }

        .message-text {
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .message-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            opacity: 0;
            transition: var(--transition);
        }

        .message:hover .message-actions {
            opacity: 1;
        }

        .action-button {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-color);
            font-size: 16px;
            padding: 4px;
            border-radius: 4px;
            transition: var(--transition);
        }

        .message.user .action-button {
            color: white;
        }

        .action-button:hover {
            background-color: rgba(0,0,0,0.1);
        }

        .message.user .action-button:hover {
            background-color: rgba(255,255,255,0.2);
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .user-avatar {
            background-color: #1a73e8;
            color: white;
        }

        .ai-avatar {
            background-color: #34a853;
            color: white;
        }

        .chat-composer {
            padding: 16px 24px;
            border-top: 1px solid var(--border-color);
            background-color: var(--card-color);
        }

        .composer-container {
            display: flex;
            align-items: center;
            gap: 12px;
            background-color: var(--hover-color);
            border-radius: 24px;
            padding: 8px 16px;
        }

        .composer-input {
            flex: 1;
            border: none;
            background: transparent;
            padding: 8px 0;
            font-size: 16px;
            color: var(--text-color);
            outline: none;
            resize: none;
            max-height: 120px;
            overflow-y: auto;
        }

        .composer-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .suggestion-chips {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .suggestion-chip {
            background-color: var(--hover-color);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 8px 12px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: var(--transition);
        }

        .suggestion-chip:hover {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* Right Panel */
        .right-panel {
            width: 300px;
            background-color: var(--card-color);
            border-left: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .panel-section {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .panel-title {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .faq-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .faq-item {
            padding: 12px;
            background-color: var(--hover-color);
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: var(--transition);
        }

        .faq-item:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .notification-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .notification-item {
            padding: 12px;
            background-color: var(--hover-color);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-title {
            font-weight: 500;
        }

        .notification-time {
            font-size: 12px;
            color: #5f6368;
        }

        .notification-message {
            font-size: 14px;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .tool-button {
            padding: 16px;
            background-color: var(--hover-color);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .tool-button:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .tool-icon {
            font-size: 24px;
        }

        .tool-label {
            font-size: 14px;
            font-weight: 500;
        }

        /* Image Generation Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            display: none;
        }

        .modal {
            background-color: var(--card-color);
            border-radius: 12px;
            padding: 24px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 500;
        }

        .close-button {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-color);
            padding: 4px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .close-button:hover {
            background-color: var(--hover-color);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--background-color);
            color: var(--text-color);
            font-size: 16px;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
        }

        .checkbox {
            width: 16px;
            height: 16px;
        }

        .submit-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
        }

        .submit-button:hover {
            background-color: #3367d6;
        }

        .image-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 16px;
            margin-top: 24px;
        }

        .image-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .image-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            display: block;
        }

        .image-actions {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            padding: 8px;
            display: flex;
            justify-content: space-between;
            opacity: 0;
            transition: var(--transition);
        }

        .image-item:hover .image-actions {
            opacity: 1;
        }

        .gallery-button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: var(--transition);
        }

        .gallery-button:hover {
            background-color: rgba(255,255,255,0.2);
        }

        /* Toast Notification */
        .toast-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background-color: var(--card-color);
            border-left: 4px solid var(--primary-color);
            padding: 16px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast-icon {
            font-size: 24px;
            color: var(--primary-color);
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .toast-message {
            font-size: 14px;
            color: #5f6368;
        }

        .toast-close {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: var(--text-color);
            padding: 4px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .toast-close:hover {
            background-color: var(--hover-color);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar, .right-panel {
                width: 100%;
                max-height: 300px;
            }
            
            .message {
                max-width: 90%;
            }
            
            .modal {
                width: 95%;
                margin: 16px;
            }
        }

        /* Settings Panel */
        .settings-panel {
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            width: 300px;
            background-color: var(--card-color);
            box-shadow: -2px 0 5px rgba(0,0,0,0.1);
            padding: 24px;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }

        .settings-panel.active {
            transform: translateX(0);
        }

        .settings-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }

        .settings-overlay.active {
            display: block;
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .settings-title {
            font-size: 20px;
            font-weight: 500;
        }

        .settings-group {
            margin-bottom: 24px;
        }

        .settings-label {
            display: block;
            margin-bottom: 12px;
            font-weight: 500;
        }

        .toggle-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .toggle-label {
            font-weight: 500;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .about-section {
            background-color: var(--hover-color);
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .about-title {
            font-weight: 500;
            margin-bottom: 8px;
        }

        .about-content {
            font-size: 14px;
            line-height: 1.5;
        }

        /* Loading Indicator */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            -webkit-animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { -webkit-transform: rotate(360deg); }
        }

        @-webkit-keyframes spin {
            to { -webkit-transform: rotate(360deg); }
        }

        /* Confirmation Modal */
        .confirm-modal {
            background-color: var(--card-color);
            border-radius: 12px;
            padding: 24px;
            width: 90%;
            max-width: 400px;
            box-shadow: var(--shadow);
        }

        .confirm-message {
            margin-bottom: 24px;
            font-size: 16px;
            line-height: 1.5;
        }

        .confirm-buttons {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .cancel-button {
            background-color: var(--hover-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
        }

        .cancel-button:hover {
            background-color: #e8eaed;
        }

        .delete-button {
            background-color: #ea4335;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
        }

        .delete-button:hover {
            background-color: #d93025;
        }

        /* Hindi Language Support */
        .hindi {
            font-family: 'Noto Sans Devanagari', sans-serif;
        }

        /* PWA Install Button */
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background-color: var(--primary-color);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            display: none;
            z-index: 1000;
            cursor: pointer;
        }

        .install-prompt.show {
            display: flex;
            align-items: center;
            gap: 8px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- System Banner -->
        <div class="system-banner" id="systemBanner">
            <span class="material-icons">info</span>
            <span id="systemMessage">System is under maintenance. Some features may be temporarily unavailable.</span>
        </div>

        <!-- Header -->
        <header class="header">
            <div class="header-title">
                <span class="material-icons">school</span>
                <span>Milli Ai</span>
            </div>
            <div class="header-actions">
                <button class="icon-button" id="languageToggle">
                    <span class="material-icons">translate</span>
                </button>
                <button class="icon-button" id="themeToggle">
                    <span class="material-icons">brightness_4</span>
                </button>
                <button class="icon-button notification-badge" id="notificationButton">
                    <span class="material-icons">notifications</span>
                    <span class="badge" id="notificationBadge">0</span>
                </button>
                <button class="icon-button" id="settingsButton">
                    <span class="material-icons">settings</span>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar - Chat List -->
            <div class="sidebar">
                <div class="sidebar-header">
                    <h2>Chats</h2>
                    <button class="new-chat-btn" id="newChatBtn">
                        <span class="material-icons">add</span>
                        New Chat
                    </button>
                </div>
                <div class="chat-list" id="chatList">
                    <!-- Chat items will be dynamically added here -->
                </div>
            </div>

            <!-- Chat Area -->
            <div class="chat-area">
                <div class="chat-messages" id="chatMessages">
                    <!-- Messages will be dynamically added here -->
                    <div class="message message-ai">
                        <div class="avatar ai-avatar">M</div>
                        <div class="message-content">
                            <div class="message-text" id="greetingMessage">Good morning! Ask me anything about study.</div>
                            <div class="message-actions">
                                <button class="action-button" title="Regenerate">
                                    <span class="material-icons">autorenew</span>
                                </button>
                                <button class="action-button" title="Like">
                                    <span class="material-icons">thumb_up</span>
                                </button>
                                <button class="action-button" title="Dislike">
                                    <span class="material-icons">thumb_down</span>
                                </button>
                                <button class="action-button" title="Copy">
                                    <span class="material-icons">content_copy</span>
                                </button>
                                <button class="action-button" title="Save">
                                    <span class="material-icons">bookmark</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="chat-composer">
                    <div class="composer-container">
                        <button class="icon-button" id="micButton">
                            <span class="material-icons">mic</span>
                        </button>
                        <textarea class="composer-input" id="messageInput" placeholder="Type your message..." rows="1"></textarea>
                        <div class="composer-actions">
                            <button class="icon-button" id="fileButton">
                                <span class="material-icons">attach_file</span>
                            </button>
                            <button class="icon-button" id="imageButton">
                                <span class="material-icons">image</span>
                            </button>
                            <button class="icon-button" id="sendButton">
                                <span class="material-icons">send</span>
                            </button>
                        </div>
                    </div>
                    <div class="suggestion-chips" id="suggestionChips">
                        <!-- Suggestions will be dynamically added here -->
                        <div class="suggestion-chip">
                            <span class="material-icons">lightbulb</span>
                            <span>What is photosynthesis?</span>
                        </div>
                        <div class="suggestion-chip">
                            <span class="material-icons">lightbulb</span>
                            <span>How to solve quadratic equations?</span>
                        </div>
                        <div class="suggestion-chip">
                            <span class="material-icons">lightbulb</span>
                            <span>Explain Newton's laws</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel -->
            <div class="right-panel">
                <!-- Top 10 Most Asked Questions -->
                <div class="panel-section">
                    <h3 class="panel-title">
                        <span class="material-icons">help</span>
                        Top 10 Questions
                    </h3>
                    <div class="faq-list" id="faqList">
                        <!-- FAQ items will be dynamically added here -->
                    </div>
                </div>

                <!-- Notifications Center -->
                <div class="panel-section">
                    <h3 class="panel-title">
                        <span class="material-icons">notifications</span>
                        Notifications
                    </h3>
                    <div class="notification-list" id="notificationList">
                        <!-- Notifications will be dynamically added here -->
                    </div>
                </div>

                <!-- Quick Tools -->
                <div class="panel-section">
                    <h3 class="panel-title">
                        <span class="material-icons">build</span>
                        Quick Tools
                    </h3>
                    <div class="tools-grid">
                        <div class="tool-button" id="generateImageButton">
                            <span class="material-icons tool-icon">image</span>
                            <span class="tool-label">Generate Image</span>
                        </div>
                        <div class="tool-button" id="uploadFileButton">
                            <span class="material-icons tool-icon">upload_file</span>
                            <span class="tool-label">Upload File</span>
                        </div>
                        <div class="tool-button" id="saveChatButton">
                            <span class="material-icons tool-icon">save</span>
                            <span class="tool-label">Save Chat</span>
                        </div>
                        <div class="tool-button" id="exportChatButton">
                            <span class="material-icons tool-icon">file_download</span>
                            <span class="tool-label">Export</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Generation Modal -->
    <div class="modal-overlay" id="imageModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Generate Image</h3>
                <button class="close-button" id="closeImageModal">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="form-group">
                <label class="form-label" for="imagePrompt">Describe your image</label>
                <textarea class="form-input" id="imagePrompt" rows="3" placeholder="A beautiful landscape with mountains and a river..."></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">Style</label>
                <select class="form-input" id="imageStyle">
                    <option value="realistic">Realistic</option>
                    <option value="cartoon">Cartoon</option>
                    <option value="anime">Anime</option>
                    <option value="painting">Painting</option>
                    <option value="sketch">Sketch</option>
                </select>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" class="checkbox" id="nsfwToggle">
                <label for="nsfwToggle">Allow NSFW content</label>
            </div>
            <button class="submit-button" id="generateImageBtn">Generate Image</button>
            
            <div class="image-gallery" id="imageGallery">
                <!-- Generated images will appear here -->
            </div>
        </div>
    </div>

    <!-- Settings Panel -->
    <div class="settings-overlay" id="settingsOverlay"></div>
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-header">
            <h3 class="settings-title">Settings</h3>
            <button class="close-button" id="closeSettings">
                <span class="material-icons">close</span>
            </button>
        </div>
        
        <div class="settings-group">
            <h4 class="settings-label">Appearance</h4>
            <div class="toggle-container">
                <span class="toggle-label">Dark Theme</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="darkThemeToggle">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
        
        <div class="settings-group">
            <h4 class="settings-label">Language</h4>
            <div class="toggle-container">
                <span class="toggle-label">Hindi</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="hindiToggle">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
        
        <div class="settings-group">
            <h4 class="settings-label">Notifications</h4>
            <div class="toggle-container">
                <span class="toggle-label">Browser Notifications</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="browserNotificationsToggle">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="toggle-container">
                <span class="toggle-label">Sound</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="soundToggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="toggle-container">
                <span class="toggle-label">Vibration</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="vibrationToggle">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
        
        <div class="settings-group">
            <h4 class="settings-label">About</h4>
            <div class="about-section">
                <h5 class="about-title">Developer</h5>
                <p class="about-content">Abutalha — Class 6 — Study in your school (Milli karwaan public school Balrampur). Phone: 9839469669</p>
            </div>
            <div class="about-section">
                <h5 class="about-title">School</h5>
                <p class="about-content">Milli Karwaan Public School (MKPS)<br>Address: Baluha Police Chowki, Balrampur (Uttar Pradesh)<br>Contact: 9758919151</p>
            </div>
            <div class="about-section">
                <h5 class="about-title">Milli Ai</h5>
                <p class="about-content">I am Milli Ai — your study assistant built to help with schoolwork, practice exercises, and quick answers.</p>
            </div>
        </div>
        
        <div class="settings-group">
            <h4 class="settings-label">Privacy & Terms</h4>
            <p class="about-content">We respect your privacy and store minimal data. All communications are encrypted and secure.</p>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer">
        <!-- Toasts will be dynamically added here -->
    </div>

    <!-- Confirmation Modal -->
    <div class="modal-overlay" id="confirmModal">
        <div class="confirm-modal">
            <div class="confirm-message" id="confirmMessage">Are you sure you want to delete this chat? This action cannot be undone.</div>
            <div class="confirm-buttons">
                <button class="cancel-button" id="cancelConfirm">Cancel</button>
                <button class="delete-button" id="confirmAction">Delete</button>
            </div>
        </div>
    </div>

    <!-- PWA Install Prompt -->
    <div class="install-prompt" id="installPrompt">
        <span class="material-icons">download</span>
        <span>Install Milli Ai for offline use</span>
    </div>

    <script>
        // Initialize Firebase (mock for demo purposes)
        const firebaseConfig = {
            apiKey: "AIzaSyB0fHtqeoerlckQ2RXx_VC86cZz_BJaIIU",
            authDomain: "mkps-balrampur.firebaseapp.com",
            projectId: "mkps-balrampur",
            storageBucket: "mkps-balrampur.appspot.com",
            messagingSenderId: "469227187804",
            appId: "1:469227187804:web:8abdb9b75ed05b7eadc099"
        };

        // Mock data for demo
        let currentUser = {
            uid: "user123",
            displayName: "Student",
            email: "student@example.com"
        };

        let adminUID = "PEjvSCXzScXA2q0NnVo7CUWnXrj1";
        let isUserAdmin = currentUser.uid === adminUID;

        // DOM Elements
        const systemBanner = document.getElementById('systemBanner');
        const systemMessage = document.getElementById('systemMessage');
        const themeToggle = document.getElementById('themeToggle');
        const languageToggle = document.getElementById('languageToggle');
        const notificationButton = document.getElementById('notificationButton');
        const notificationBadge = document.getElementById('notificationBadge');
        const settingsButton = document.getElementById('settingsButton');
        const newChatBtn = document.getElementById('newChatBtn');
        const chatList = document.getElementById('chatList');
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const micButton = document.getElementById('micButton');
        const fileButton = document.getElementById('fileButton');
        const imageButton = document.getElementById('imageButton');
        const suggestionChips = document.getElementById('suggestionChips');
        const faqList = document.getElementById('faqList');
        const notificationList = document.getElementById('notificationList');
        const generateImageButton = document.getElementById('generateImageButton');
        const uploadFileButton = document.getElementById('uploadFileButton');
        const saveChatButton = document.getElementById('saveChatButton');
        const exportChatButton = document.getElementById('exportChatButton');
        const imageModal = document.getElementById('imageModal');
        const closeImageModal = document.getElementById('closeImageModal');
        const imagePrompt = document.getElementById('imagePrompt');
        const imageStyle = document.getElementById('imageStyle');
        const nsfwToggle = document.getElementById('nsfwToggle');
        const generateImageBtn = document.getElementById('generateImageBtn');
        const imageGallery = document.getElementById('imageGallery');
        const settingsPanel = document.getElementById('settingsPanel');
        const settingsOverlay = document.getElementById('settingsOverlay');
        const closeSettings = document.getElementById('closeSettings');
        const darkThemeToggle = document.getElementById('darkThemeToggle');
        const hindiToggle = document.getElementById('hindiToggle');
        const browserNotificationsToggle = document.getElementById('browserNotificationsToggle');
        const soundToggle = document.getElementById('soundToggle');
        const vibrationToggle = document.getElementById('vibrationToggle');
        const toastContainer = document.getElementById('toastContainer');
        const confirmModal = document.getElementById('confirmModal');
        const confirmMessage = document.getElementById('confirmMessage');
        const cancelConfirm = document.getElementById('cancelConfirm');
        const confirmAction = document.getElementById('confirmAction');
        const installPrompt = document.getElementById('installPrompt');
        const greetingMessage = document.getElementById('greetingMessage');

        // State variables
        let currentChatId = null;
        let isDarkTheme = false;
        let isHindi = false;
        let notificationCount = 0;
        let isSystemMaintenance = false;
        let isListening = false;
        let pendingImageJobs = [];

        // Sample data
        const sampleChats = [
            { id: 'chat1', title: 'Math Homework Help', lastMessage: 'Thanks for explaining!', time: '2 min ago', isPinned: true },
            { id: 'chat2', title: 'Science Project', lastMessage: 'What materials do I need?', time: '1 hour ago', isPinned: false },
            { id: 'chat3', title: 'History Questions', lastMessage: 'Can you summarize the French Revolution?', time: '3 hours ago', isPinned: false }
        ];

        const sampleFAQs = [
            "What is photosynthesis?",
            "How to solve quadratic equations?",
            "Explain Newton's laws of motion",
            "What are the parts of a plant?",
            "How to write a good essay?",
            "What is the water cycle?",
            "Explain fractions in math",
            "What are the states of matter?",
            "How to study effectively?",
            "What is gravity?"
        ];

        const sampleNotifications = [
            { id: 'notif1', title: 'New Feature', message: 'Image generation is now available!', time: '5 min ago', read: false },
            { id: 'notif2', title: 'System Update', message: 'Maintenance scheduled for tomorrow', time: '2 hours ago', read: true },
            { id: 'notif3', title: 'Tip of the Day', message: 'Use voice input for faster questions!', time: '1 day ago', read: true }
        ];

        // Initialize the app
        function initApp() {
            // Set greeting based on time of day
            setGreeting();
            
            // Load theme preference
            loadThemePreference();
            
            // Load language preference
            loadLanguagePreference();
            
            // Render sample chats
            renderChats();
            
            // Render FAQs
            renderFAQs();
            
            // Render notifications
            renderNotifications();
            
            // Check for system maintenance
            checkSystemMaintenance();
            
            // Request notification permission
            requestNotificationPermission();
            
            // Show install prompt for PWA
            showInstallPrompt();
            
            // Add event listeners
            addEventListeners();
        }

        // Set greeting based on time of day
        function setGreeting() {
            const hour = new Date().getHours();
            let greeting;
            
            if (isHindi) {
                if (hour < 12) {
                    greeting = "शुभ प्रभात! पढ़ाई के बारे में मुझसे कुछ भी पूछो।";
                } else if (hour < 18) {
                    greeting = "शुभ अपराह्न! पढ़ाई के बारे में मुझसे कुछ भी पूछो।";
                } else {
                    greeting = "शुभ रात्रि! पढ़ाई के बारे में मुझसे कुछ भी पूछो।";
                }
            } else {
                if (hour < 12) {
                    greeting = "Good morning! Ask me anything about study.";
                } else if (hour < 18) {
                    greeting = "Good afternoon! Ask me anything about study.";
                } else {
                    greeting = "Good evening! Ask me anything about study.";
                }
            }
            
            greetingMessage.textContent = greeting;
        }

        // Load theme preference
        function loadThemePreference() {
            const savedTheme = localStorage.getItem('darkTheme');
            if (savedTheme === 'true') {
                document.body.classList.add('dark-theme');
                isDarkTheme = true;
                themeToggle.innerHTML = '<span class="material-icons">brightness_7</span>';
                darkThemeToggle.checked = true;
            }
        }

        // Load language preference
        function loadLanguagePreference() {
            const savedLanguage = localStorage.getItem('hindiLanguage');
            if (savedLanguage === 'true') {
                isHindi = true;
                document.body.classList.add('hindi');
                hindiToggle.checked = true;
                updateUIText();
            }
        }

        // Render chats
        function renderChats() {
            chatList.innerHTML = '';
            
            // Add "Start New Chat" button at top
            const newChatItem = document.createElement('div');
            newChatItem.className = 'chat-item';
            newChatItem.innerHTML = `
                <div class="chat-avatar" style="background-color: #4285f4;">+</div>
                <div class="chat-info">
                    <div class="chat-title">Start New Chat</div>
                </div>
            `;
            newChatItem.addEventListener('click', startNewChat);
            chatList.appendChild(newChatItem);
            
            // Add sample chats
            sampleChats.forEach(chat => {
                const chatItem = document.createElement('div');
                chatItem.className = `chat-item ${currentChatId === chat.id ? 'active' : ''}`;
                chatItem.dataset.chatId = chat.id;
                
                const pinIcon = chat.isPinned ? '<span class="material-icons" style="font-size: 16px; color: #fbbc04;">push_pin</span>' : '';
                
                chatItem.innerHTML = `
                    <div class="chat-avatar" style="background-color: #34a853;">M</div>
                    <div class="chat-info">
                        <div class="chat-title">${chat.title} ${pinIcon}</div>
                        <div class="chat-preview">${chat.lastMessage}</div>
                    </div>
                    <div class="chat-time">${chat.time}</div>
                    <div class="chat-menu">
                        <button class="icon-button chat-menu-btn" data-chat-id="${chat.id}">
                            <span class="material-icons">more_vert</span>
                        </button>
                        <div class="menu-dropdown" id="menu-${chat.id}">
                            <div class="menu-item" data-action="rename" data-chat-id="${chat.id}">
                                <span class="material-icons">edit</span>
                                <span>Rename</span>
                            </div>
                            <div class="menu-item" data-action="delete" data-chat-id="${chat.id}">
                                <span class="material-icons">delete</span>
                                <span>Delete</span>
                            </div>
                            <div class="menu-item" data-action="archive" data-chat-id="${chat.id}">
                                <span class="material-icons">archive</span>
                                <span>Archive</span>
                            </div>
                            <div class="menu-item" data-action="export" data-chat-id="${chat.id}">
                                <span class="material-icons">file_download</span>
                                <span>Export</span>
                            </div>
                            <div class="menu-item" data-action="pin" data-chat-id="${chat.id}">
                                <span class="material-icons">${chat.isPinned ? 'push_pin' : 'bookmark_border'}</span>
                                <span>${chat.isPinned ? 'Unpin' : 'Pin'}</span>
                            </div>
                            <div class="menu-item" data-action="share" data-chat-id="${chat.id}">
                                <span class="material-icons">share</span>
                                <span>Share</span>
                            </div>
                        </div>
                    </div>
                `;
                
                chatItem.addEventListener('click', function(e) {
                    if (!e.target.closest('.chat-menu-btn') && !e.target.closest('.menu-dropdown')) {
                        selectChat(chat.id);
                    }
                });
                
                chatList.appendChild(chatItem);
            });
            
            // Add event listeners for menu buttons
            document.querySelectorAll('.chat-menu-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const chatId = this.dataset.chatId;
                    toggleChatMenu(chatId);
                });
            });
            
            // Close menus when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.chat-menu-btn') && !e.target.closest('.menu-dropdown')) {
                    document.querySelectorAll('.menu-dropdown').forEach(menu => {
                        menu.style.display = 'none';
                    });
                }
            });
        }

        // Render FAQs
        function renderFAQs() {
            faqList.innerHTML = '';
            
            sampleFAQs.forEach((faq, index) => {
                const faqItem = document.createElement('div');
                faqItem.className = 'faq-item';
                faqItem.textContent = `${index + 1}. ${faq}`;
                faqItem.addEventListener('click', () => {
                    messageInput.value = faq;
                    sendMessage();
                });
                faqList.appendChild(faqItem);
            });
        }

        // Render notifications
        function renderNotifications() {
            notificationList.innerHTML = '';
            
            // Count unread notifications
            notificationCount = sampleNotifications.filter(n => !n.read).length;
            notificationBadge.textContent = notificationCount;
            
            if (notificationCount > 0) {
                notificationBadge.style.display = 'block';
            } else {
                notificationBadge.style.display = 'none';
            }
            
            sampleNotifications.forEach(notif => {
                const notifItem = document.createElement('div');
                notifItem.className = 'notification-item';
                if (!notif.read) {
                    notifItem.style.borderLeft = '3px solid #4285f4';
                }
                
                notifItem.innerHTML = `
                    <div class="notification-header">
                        <div class="notification-title">${notif.title}</div>
                        <div class="notification-time">${notif.time}</div>
                    </div>
                    <div class="notification-message">${notif.message}</div>
                `;
                
                notifItem.addEventListener('click', () => {
                    markNotificationAsRead(notif.id);
                });
                
                notificationList.appendChild(notifItem);
            });
        }

        // Check system maintenance
        function checkSystemMaintenance() {
            // In a real app, this would check Firestore
            // For demo, we'll simulate maintenance mode
            isSystemMaintenance = false; // Set to true to show banner
            
            if (isSystemMaintenance) {
                systemBanner.classList.add('active');
                systemMessage.textContent = "System is under maintenance. Some features may be temporarily unavailable.";
            } else {
                systemBanner.classList.remove('active');
            }
        }

        // Request notification permission
        function requestNotificationPermission() {
            if ('Notification' in window) {
                if (Notification.permission === 'granted') {
                    // Permission already granted
                } else if (Notification.permission !== 'denied') {
                    Notification.requestPermission().then(function (permission) {
                        if (permission === 'granted') {
                            showToast('Notifications enabled', 'You will receive browser notifications.');
                        }
                    });
                }
            }
        }

        // Show install prompt for PWA
        function showInstallPrompt() {
            // This would be implemented with beforeinstallprompt event in a real PWA
            // For demo, we'll show it after 5 seconds
            setTimeout(() => {
                installPrompt.classList.add('show');
            }, 5000);
        }

        // Add event listeners
        function addEventListeners() {
            // Theme toggle
            themeToggle.addEventListener('click', toggleTheme);
            darkThemeToggle.addEventListener('change', function() {
                toggleTheme();
            });
            
            // Language toggle
            languageToggle.addEventListener('click', toggleLanguage);
            hindiToggle.addEventListener('change', function() {
                toggleLanguage();
            });
            
            // Settings
            settingsButton.addEventListener('click', toggleSettings);
            closeSettings.addEventListener('click', toggleSettings);
            settingsOverlay.addEventListener('click', toggleSettings);
            
            // New chat
            newChatBtn.addEventListener('click', startNewChat);
            
            // Send message
            sendButton.addEventListener('click', sendMessage);
            messageInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // Mic button
            micButton.addEventListener('click', toggleVoiceInput);
            
            // File upload
            fileButton.addEventListener('click', handleFileUpload);
            uploadFileButton.addEventListener('click', handleFileUpload);
            
            // Image generation
            imageButton.addEventListener('click', openImageModal);
            generateImageButton.addEventListener('click', openImageModal);
            closeImageModal.addEventListener('click', closeImageModalFunc);
            generateImageBtn.addEventListener('click', generateImage);
            
            // Save chat
            saveChatButton.addEventListener('click', saveCurrentChat);
            
            // Export chat
            exportChatButton.addEventListener('click', exportChat);
            
            // Install prompt
            installPrompt.addEventListener('click', installPWA);
            
            // Confirmation modal
            cancelConfirm.addEventListener('click', hideConfirmModal);
            
            // Menu item actions
            document.addEventListener('click', function(e) {
                if (e.target.closest('.menu-item')) {
                    const action = e.target.closest('.menu-item').dataset.action;
                    const chatId = e.target.closest('.menu-item').dataset.chatId;
                    handleMenuAction(action, chatId);
                }
            });
        }

        // Toggle theme
        function toggleTheme() {
            isDarkTheme = !isDarkTheme;
            document.body.classList.toggle('dark-theme');
            localStorage.setItem('darkTheme', isDarkTheme);
            
            if (isDarkTheme) {
                themeToggle.innerHTML = '<span class="material-icons">brightness_7</span>';
                darkThemeToggle.checked = true;
            } else {
                themeToggle.innerHTML = '<span class="material-icons">brightness_4</span>';
                darkThemeToggle.checked = false;
            }
        }

        // Toggle language
        function toggleLanguage() {
            isHindi = !isHindi;
            document.body.classList.toggle('hindi');
            localStorage.setItem('hindiLanguage', isHindi);
            hindiToggle.checked = isHindi;
            updateUIText();
        }

        // Update UI text based on language
        function updateUIText() {
            if (isHindi) {
                document.querySelector('.header-title span:last-child').textContent = "मिल्ली एआई";
                document.querySelector('.new-chat-btn span:last-child').textContent = "नया चैट";
                document.querySelector('.panel-title:nth-child(1) span:last-child').textContent = "शीर्ष 10 प्रश्न";
                document.querySelector('.panel-title:nth-child(2) span:last-child').textContent = "सूचनाएं";
                document.querySelector('.panel-title:nth-child(3) span:last-child').textContent = "त्वरित उपकरण";
                document.querySelector('.modal-title').textContent = "छवि उत्पन्न करें";
                document.querySelector('label[for="imagePrompt"]').textContent = "अपनी छवि का वर्णन करें";
                document.querySelector('.settings-title').textContent = "सेटिंग्स";
                document.querySelector('.about-section:nth-child(1) .about-title').textContent = "डेवलपर";
                document.querySelector('.about-section:nth-child(2) .about-title').textContent = "स्कूल";
                document.querySelector('.about-section:nth-child(3) .about-title').textContent = "मिल्ली एआई";
                
                // Update greeting
                setGreeting();
            } else {
                document.querySelector('.header-title span:last-child').textContent = "Milli Ai";
                document.querySelector('.new-chat-btn span:last-child').textContent = "New Chat";
                document.querySelector('.panel-title:nth-child(1) span:last-child').textContent = "Top 10 Questions";
                document.querySelector('.panel-title:nth-child(2) span:last-child').textContent = "Notifications";
                document.querySelector('.panel-title:nth-child(3) span:last-child').textContent = "Quick Tools";
                document.querySelector('.modal-title').textContent = "Generate Image";
                document.querySelector('label[for="imagePrompt"]').textContent = "Describe your image";
                document.querySelector('.settings-title').textContent = "Settings";
                document.querySelector('.about-section:nth-child(1) .about-title').textContent = "Developer";
                document.querySelector('.about-section:nth-child(2) .about-title').textContent = "School";
                document.querySelector('.about-section:nth-child(3) .about-title').textContent = "Milli Ai";
                
                // Update greeting
                setGreeting();
            }
        }

        // Toggle settings panel
        function toggleSettings() {
            settingsPanel.classList.toggle('active');
            settingsOverlay.classList.toggle('active');
        }

        // Start new chat
        function startNewChat() {
            // Generate a new chat ID
            const newChatId = 'chat' + (sampleChats.length + 1);
            
            // Create a temporary chat
            const newChat = {
                id: newChatId,
                title: 'New Chat',
                lastMessage: '',
                time: 'Just now',
                isPinned: false
            };
            
            // Add to sample chats
            sampleChats.unshift(newChat);
            
            // Select the new chat
            selectChat(newChatId);
            
            // Clear chat messages
            chatMessages.innerHTML = '';
            
            // Add greeting message
            addMessage('Milli Ai', getGreetingText(), 'ai');
            
            // Render chats
            renderChats();
            
            // Focus on input
            messageInput.focus();
        }

        // Select chat
        function selectChat(chatId) {
            currentChatId = chatId;
            renderChats(); // Re-render to show active state
            
            // In a real app, this would load the chat messages from Firestore
            // For demo, we'll just clear and add a greeting
            chatMessages.innerHTML = '';
            addMessage('Milli Ai', getGreetingText(), 'ai');
        }

        // Get greeting text
        function getGreetingText() {
            const hour = new Date().getHours();
            
            if (isHindi) {
                if (hour < 12) {
                    return "शुभ प्रभात! पढ़ाई के बारे में मुझसे कुछ भी पूछो।";
                } else if (hour < 18) {
                    return "शुभ अपराह्न! पढ़ाई के बारे में मुझसे कुछ भी पूछो।";
                } else {
                    return "शुभ रात्रि! पढ़ाई के बारे में मुझसे कुछ भी पूछो।";
                }
            } else {
                if (hour < 12) {
                    return "Good morning! Ask me anything about study.";
                } else if (hour < 18) {
                    return "Good afternoon! Ask me anything about study.";
                } else {
                    return "Good evening! Ask me anything about study.";
                }
            }
        }

        // Send message
        function sendMessage() {
            const message = messageInput.value.trim();
            if (message === '') return;
            
            // Add user message
            addMessage(currentUser.displayName || 'You', message, 'user');
            
            // Clear input
            messageInput.value = '';
            
            // Simulate AI response after a delay
            setTimeout(() => {
                const aiResponse = getAIResponse(message);
                addMessage('Milli Ai', aiResponse, 'ai');
                
                // Auto-rename chat based on first message
                if (currentChatId && sampleChats.find(chat => chat.id === currentChatId) && sampleChats.find(chat => chat.id === currentChatId).title === 'New Chat') {
                    autoRenameChat(message);
                }
            }, 1000);
        }

        // Add message to chat
        function addMessage(sender, text, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${type}`;
            
            const avatarInitial = sender.charAt(0);
            const avatarClass = type === 'user' ? 'user-avatar' : 'ai-avatar';
            const avatarBgColor = type === 'user' ? '#1a73e8' : '#34a853';
            
            messageDiv.innerHTML = `
                <div class="avatar ${avatarClass}" style="background-color: ${avatarBgColor};">${avatarInitial}</div>
                <div class="message-content">
                    <div class="message-text">${text}</div>
                    <div class="message-actions">
                        <button class="action-button" title="Regenerate">
                            <span class="material-icons">autorenew</span>
                        </button>
                        <button class="action-button" title="Like">
                            <span class="material-icons">thumb_up</span>
                        </button>
                        <button class="action-button" title="Dislike">
                            <span class="material-icons">thumb_down</span>
                        </button>
                        <button class="action-button" title="Copy">
                            <span class="material-icons">content_copy</span>
                        </button>
                        <button class="action-button" title="Save">
                            <span class="material-icons">bookmark</span>
                        </button>
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Add event listeners to action buttons
            const actionButtons = messageDiv.querySelectorAll('.action-button');
            actionButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const action = this.querySelector('.material-icons').textContent;
                    handleMessageAction(action, text, type);
                });
            });
        }

        // Get AI response (simulated)
        function getAIResponse(userMessage) {
            // This would call the Gemini API in a real app
            // For demo, we'll return a simple response
            
            if (isHindi) {
                if (userMessage.toLowerCase().includes('photosynthesis')) {
                    return "प्रकाश संश्लेषण पौधों द्वारा सूर्य के प्रकाश, कार्बन डाइऑक्साइड और पानी का उपयोग करके भोजन (ग्लूकोज) बनाने की प्रक्रिया है। यह प्रक्रिया क्लोरोफिल नामक हरे वर्णक द्वारा होती है।\n\nउदाहरण: पेड़ सूरज की रोशनी का उपयोग करके हवा से कार्बन डाइऑक्साइड और जमीन से पानी लेते हैं और ऑक्सीजन छोड़ते हुए अपना भोजन बनाते हैं।\n\nअभ्यास: प्रकाश संश्लेषण के लिए आवश्यक तीन चीजों के नाम लिखें।";
                } else if (userMessage.toLowerCase().includes('quadratic') || userMessage.toLowerCase().includes('equation')) {
                    return "द्विघात समीकरण ax² + bx + c = 0 के रूप का होता है। इसे हल करने के लिए हम द्विघात सूत्र का उपयोग करते हैं: x = (-b ± √(b² - 4ac)) / 2a\n\nउदाहरण: x² - 5x + 6 = 0 के लिए, a=1, b=-5, c=6. इसलिए x = (5 ± √(25-24))/2 = (5 ± 1)/2, इसलिए x=3 या x=2.\n\nअभ्यास: x² - 3x - 10 = 0 को हल करें।";
                } else if (userMessage.toLowerCase().includes('newton') || userMessage.toLowerCase().includes('laws')) {
                    return "न्यूटन के गति के तीन नियम हैं:\n1. जड़ता का नियम: कोई वस्तु अपनी विराम या समान गति की अवस्था में तब तक रहती है जब तक कोई बाहरी बल उसे बदलने के लिए मजबूर न करे।\n2. F = ma: बल द्रव्यमान और त्वरण के गुणनफल के बराबर होता है।\n3. क्रिया-प्रतिक्रिया: हर क्रिया के लिए एक बराबर और विपरीत प्रतिक्रिया होती है।\n\nउदाहरण: जब आप दीवार को धक्का देते हैं, तो दीवार भी आपको उतनी ही शक्ति से धक्का देती है।\n\nअभ्यास: न्यूटन के दूसरे नियम के अनुसार, यदि 5 किग्रा द्रव्यमान पर 10 एन का बल लगाया जाता है, तो त्वरण क्या होगा?";
                } else {
                    return "धन्यवाद आपके प्रश्न के लिए! मैं आपकी पढ़ाई में मदद करने के लिए यहाँ हूँ। क्या आप अपना प्रश्न थोड़ा और स्पष्ट कर सकते हैं? मैं आपको एक उदाहरण और एक अभ्यास प्रश्न के साथ विस्तार से समझाने के लिए तैयार हूँ।";
                }
            } else {
                if (userMessage.toLowerCase().includes('photosynthesis')) {
                    return "Photosynthesis is the process by which plants use sunlight, carbon dioxide, and water to produce food (glucose). This process occurs in chlorophyll, the green pigment in plants.\n\nExample: Trees use sunlight to take carbon dioxide from the air and water from the ground to make their food while releasing oxygen.\n\nExercise: Name three things required for photosynthesis.";
                } else if (userMessage.toLowerCase().includes('quadratic') || userMessage.toLowerCase().includes('equation')) {
                    return "A quadratic equation is of the form ax² + bx + c = 0. We use the quadratic formula to solve it: x = (-b ± √(b² - 4ac)) / 2a\n\nExample: For x² - 5x + 6 = 0, a=1, b=-5, c=6. So x = (5 ± √(25-24))/2 = (5 ± 1)/2, thus x=3 or x=2.\n\nExercise: Solve x² - 3x - 10 = 0.";
                } else if (userMessage.toLowerCase().includes('newton') || userMessage.toLowerCase().includes('laws')) {
                    return "Newton's three laws of motion are:\n1. Law of Inertia: An object remains in its state of rest or uniform motion unless acted upon by an external force.\n2. F = ma: Force equals mass times acceleration.\n3. Action-Reaction: For every action, there is an equal and opposite reaction.\n\nExample: When you push a wall, the wall pushes back with equal force.\n\nExercise: According to Newton's second law, what would be the acceleration if a force of 10N is applied to a mass of 5kg?";
                } else {
                    return "Thank you for your question! I'm here to help with your studies. Could you please clarify your question a bit more? I'm ready to explain in detail with an example and a practice question.";
                }
            }
        }

        // Auto-rename chat based on first message
        function autoRenameChat(firstMessage) {
            // This would call AI to generate a title in a real app
            // For demo, we'll use a simple approach
            
            let title = 'New Chat';
            
            if (isHindi) {
                if (firstMessage.toLowerCase().includes('photosynthesis')) {
                    title = 'प्रकाश संश्लेषण';
                } else if (firstMessage.toLowerCase().includes('quadratic') || firstMessage.toLowerCase().includes('equation')) {
                    title = 'द्विघात समीकरण';
                } else if (firstMessage.toLowerCase().includes('newton') || firstMessage.toLowerCase().includes('laws')) {
                    title = 'न्यूटन के नियम';
                } else if (firstMessage.length > 10) {
                    title = firstMessage.substring(0, 20) + '...';
                }
            } else {
                if (firstMessage.toLowerCase().includes('photosynthesis')) {
                    title = 'Photosynthesis';
                } else if (firstMessage.toLowerCase().includes('quadratic') || firstMessage.toLowerCase().includes('equation')) {
                    title = 'Quadratic Equations';
                } else if (firstMessage.toLowerCase().includes('newton') || firstMessage.toLowerCase().includes('laws')) {
                    title = 'Newton\'s Laws';
                } else if (firstMessage.length > 10) {
                    title = firstMessage.substring(0, 20) + '...';
                }
            }
            
            // Update chat title
            const chatIndex = sampleChats.findIndex(chat => chat.id === currentChatId);
            if (chatIndex !== -1) {
                sampleChats[chatIndex].title = title;
                renderChats();
            }
        }

        // Handle message action
        function handleMessageAction(action, text, type) {
            switch(action) {
                case 'autorenew':
                    if (type === 'ai') {
                        // In a real app, this would resend the previous user message
                        showToast('Regenerating', 'AI is generating a new response...');
                        
                        // Find the previous user message
                        const messages = Array.from(chatMessages.children);
                        let userMessage = '';
                        for (let i = messages.length - 1; i >= 0; i--) {
                            if (messages[i].classList.contains('message-user')) {
                                userMessage = messages[i].querySelector('.message-text').textContent;
                                break;
                            }
                        }
                        
                        if (userMessage) {
                            // Remove the current AI message
                            const aiMessage = messages[messages.length - 1];
                            if (aiMessage.classList.contains('message-ai')) {
                                aiMessage.remove();
                            }
                            
                            // Generate new response
                            setTimeout(() => {
                                const newResponse = getAIResponse(userMessage) + " (Regenerated)";
                                addMessage('Milli Ai', newResponse, 'ai');
                            }, 1500);
                        }
                    }
                    break;
                case 'thumb_up':
                    showToast('Feedback', 'Thank you for your positive feedback!');
                    break;
                case 'thumb_down':
                    showToast('Feedback', 'We\'re sorry to hear that. We\'ll work to improve.');
                    break;
                case 'content_copy':
                    navigator.clipboard.writeText(text).then(() => {
                        showToast('Copied', 'Text copied to clipboard!');
                    });
                    break;
                case 'bookmark':
                    showToast('Saved', 'Message saved to your notes!');
                    break;
            }
        }

        // Toggle chat menu
        function toggleChatMenu(chatId) {
            const menu = document.getElementById(`menu-${chatId}`);
            const isVisible = menu.style.display === 'block';
            
            // Hide all menus first
            document.querySelectorAll('.menu-dropdown').forEach(m => {
                m.style.display = 'none';
            });
            
            // Toggle current menu
            if (!isVisible) {
                menu.style.display = 'block';
            }
        }

        // Handle menu action
        function handleMenuAction(action, chatId) {
            switch(action) {
                case 'rename':
                    renameChat(chatId);
                    break;
                case 'delete':
                    showConfirmModal('Are you sure you want to delete this chat? This action cannot be undone.', () => {
                        deleteChat(chatId);
                    });
                    break;
                case 'archive':
                    showToast('Archived', 'Chat has been archived.');
                    break;
                case 'export':
                    exportChat(chatId);
                    break;
                case 'pin':
                    togglePinChat(chatId);
                    break;
                case 'share':
                    shareChat(chatId);
                    break;
            }
            
            // Hide menu after action
            document.getElementById(`menu-${chatId}`).style.display = 'none';
        }

        // Rename chat
        function renameChat(chatId) {
            const chatIndex = sampleChats.findIndex(chat => chat.id === chatId);
            if (chatIndex === -1) return;
            
            const newName = prompt(isHindi ? 'नया नाम दर्ज करें:' : 'Enter new name:', sampleChats[chatIndex].title);
            if (newName && newName.trim() !== '') {
                sampleChats[chatIndex].title = newName.trim();
                renderChats();
                showToast(isHindi ? 'अद्यतन' : 'Updated', isHindi ? 'चैट का नाम बदल दिया गया है।' : 'Chat name has been updated.');
            }
        }

        // Delete chat
        function deleteChat(chatId) {
            const chatIndex = sampleChats.findIndex(chat => chat.id === chatId);
            if (chatIndex === -1) return;
            
            sampleChats.splice(chatIndex, 1);
            renderChats();
            
            // If current chat was deleted, select first chat or start new one
            if (currentChatId === chatId) {
                if (sampleChats.length > 0) {
                    selectChat(sampleChats[0].id);
                } else {
                    startNewChat();
                }
            }
            
            showToast(isHindi ? 'मिटाया गया' : 'Deleted', isHindi ? 'चैट हटा दी गई है।' : 'Chat has been deleted.');
        }

        // Toggle pin chat
        function togglePinChat(chatId) {
            const chatIndex = sampleChats.findIndex(chat => chat.id === chatId);
            if (chatIndex === -1) return;
            
            sampleChats[chatIndex].isPinned = !sampleChats[chatIndex].isPinned;
            renderChats();
            
            const action = sampleChats[chatIndex].isPinned ? (isHindi ? 'पिन किया गया' : 'Pinned') : (isHindi ? 'अनपिन किया गया' : 'Unpinned');
            showToast(action, isHindi ? 'चैट अद्यतन की गई है।' : 'Chat has been updated.');
        }

        // Share chat
        function shareChat(chatId) {
            const chat = sampleChats.find(c => c.id === chatId);
            if (!chat) return;
            
            const shareText = isHindi ? 
                `मैंने "${chat.title}" चैट मिल्ली एआई के साथ की है। आप भी अपने अध्ययन प्रश्नों के लिए इसका उपयोग कर सकते हैं!` :
                `I had a chat "${chat.title}" with Milli Ai. You can also use it for your study questions!`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Milli Ai Chat',
                    text: shareText,
                    url: window.location.href
                }).catch(() => {
                    copyToClipboard(window.location.href);
                    showToast('Copied', 'Link copied to clipboard!');
                });
            } else {
                copyToClipboard(window.location.href);
                showToast('Copied', 'Link copied to clipboard!');
            }
        }

        // Copy to clipboard
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text);
        }

        // Save current chat
        function saveCurrentChat() {
            if (!currentChatId) {
                showToast(isHindi ? 'त्रुटि' : 'Error', isHindi ? 'कोई चैट चयनित नहीं है।' : 'No chat selected.');
                return;
            }
            
            showToast(isHindi ? 'सहेजा गया' : 'Saved', isHindi ? 'चैट स्थायी रूप से सहेजी गई है।' : 'Chat saved permanently.');
        }

        // Export chat
        function exportChat(chatId = currentChatId) {
            if (!chatId) {
                showToast(isHindi ? 'त्रुटि' : 'Error', isHindi ? 'कोई चैट चयनित नहीं है।' : 'No chat selected.');
                return;
            }
            
            const chat = sampleChats.find(c => c.id === chatId);
            if (!chat) return;
            
            // In a real app, this would export the actual chat messages
            // For demo, we'll export a sample JSON
            const chatData = {
                id: chatId,
                title: chat.title,
                messages: [
                    { sender: "User", text: "Hello, can you help me with my homework?", timestamp: new Date().toISOString() },
                    { sender: "Milli Ai", text: "Of course! I'd be happy to help with your homework. What subject are you working on?", timestamp: new Date(Date.now() + 1000).toISOString() }
                ]
            };
            
            const dataStr = JSON.stringify(chatData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `${chat.title.replace(/\s+/g, '_')}_chat.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast(isHindi ? 'निर्यात किया गया' : 'Exported', isHindi ? 'चैट JSON के रूप में डाउनलोड की गई है।' : 'Chat downloaded as JSON.');
        }

        // Toggle voice input
        function toggleVoiceInput() {
            if (!('SpeechRecognition' in window) && !('webkitSpeechRecognition' in window)) {
                showToast(isHindi ? 'समर्थन नहीं है' : 'Not Supported', isHindi ? 'आपका ब्राउज़र वॉयस इनपुट का समर्थन नहीं करता है।' : 'Your browser does not support voice input.');
                return;
            }
            
            if (!isListening) {
                startVoiceRecognition();
            } else {
                stopVoiceRecognition();
            }
        }

        // Start voice recognition
        function startVoiceRecognition() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();
            
            recognition.lang = isHindi ? 'hi-IN' : 'en-US';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;
            
            recognition.start();
            isListening = true;
            micButton.innerHTML = '<span class="material-icons">mic_off</span>';
            
            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                messageInput.value = transcript;
                stopVoiceRecognition();
            };
            
            recognition.onerror = function(event) {
                console.error('Speech recognition error', event.error);
                stopVoiceRecognition();
                showToast(isHindi ? 'त्रुटि' : 'Error', isHindi ? 'वॉयस इनपुट में त्रुटि हुई।' : 'Error with voice input.');
            };
            
            recognition.onend = function() {
                stopVoiceRecognition();
            };
        }

        // Stop voice recognition
        function stopVoiceRecognition() {
            isListening = false;
            micButton.innerHTML = '<span class="material-icons">mic</span>';
        }

        // Handle file upload
        function handleFileUpload() {
            // Create a hidden file input
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.style.display = 'none';
            
            fileInput.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    // In a real app, this would upload to Firebase Storage
                    // For demo, we'll just show a message
                    const fileSize = (file.size / 1024 / 1024).toFixed(2);
                    showToast('File Upload', `File "${file.name}" (${fileSize} MB) would be uploaded to Firebase Storage in a real app.`);
                    
                    // Add a message to chat about the upload
                    setTimeout(() => {
                        addMessage('Milli Ai', isHindi ? 
                            `मैंने "${file.name}" फ़ाइल प्राप्त कर ली है। क्या आप इसके बारे में कुछ पूछना चाहते हैं?` : 
                            `I've received the file "${file.name}". Would you like to ask something about it?`, 'ai');
                    }, 1000);
                }
            };
            
            document.body.appendChild(fileInput);
            fileInput.click();
            document.body.removeChild(fileInput);
        }

        // Open image modal
        function openImageModal() {
            imageModal.style.display = 'flex';
        }

        // Close image modal
        function closeImageModalFunc() {
            imageModal.style.display = 'none';
        }

        // Generate image
        function generateImage() {
            const prompt = imagePrompt.value.trim();
            if (prompt === '') {
                showToast(isHindi ? 'त्रुटि' : 'Error', isHindi ? 'कृपया एक प्रॉम्प्ट दर्ज करें।' : 'Please enter a prompt.');
                return;
            }
            
            // Show loading state
            generateImageBtn.disabled = true;
            generateImageBtn.innerHTML = '<div class="loading"></div> Generating...';
            
            // In a real app, this would call the Stable Horde API via a server proxy
            // For demo, we'll simulate a response after 3 seconds
            setTimeout(() => {
                generateImageBtn.disabled = false;
                generateImageBtn.textContent = 'Generate Image';
                
                // Generate a random image URL (placeholder)
                const randomId = Math.floor(Math.random() * 1000);
                const imageUrl = `https://placehold.co/512x512/4285f4/ffffff?text=Image+${randomId}`;
                
                // Add to gallery
                const imageItem = document.createElement('div');
                imageItem.className = 'image-item';
                imageItem.innerHTML = `
                    <img src="${imageUrl}" alt="Generated image">
                    <div class="image-actions">
                        <button class="gallery-button" title="Download">
                            <span class="material-icons">file_download</span>
                        </button>
                        <button class="gallery-button" title="Copy to chat">
                            <span class="material-icons">content_copy</span>
                        </button>
                    </div>
                `;
                
                imageGallery.appendChild(imageItem);
                
                // Add event listeners
                imageItem.querySelector('[title="Download"]').addEventListener('click', function() {
                    const a = document.createElement('a');
                    a.href = imageUrl;
                    a.download = `milli_ai_image_${randomId}.jpg`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    showToast(isHindi ? 'डाउनलोड किया गया' : 'Downloaded', isHindi ? 'छवि डाउनलोड कर ली गई है।' : 'Image downloaded.');
                });
                
                imageItem.querySelector('[title="Copy to chat"]').addEventListener('click', function() {
                    addMessage('Milli Ai', isHindi ? 
                        `यहाँ आपके लिए उत्पन्न छवि है: "${prompt}"` : 
                        `Here is the generated image for: "${prompt}"`, 'ai');
                    
                    // Add image to chat (in a real app)
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'message message-ai';
                    messageDiv.innerHTML = `
                        <div class="avatar ai-avatar" style="background-color: #34a853;">M</div>
                        <div class="message-content">
                            <img src="${imageUrl}" alt="Generated image" style="max-width: 300px; border-radius: 8px; margin: 8px 0;">
                            <div class="message-actions">
                                <button class="action-button" title="Download">
                                    <span class="material-icons">file_download</span>
                                </button>
                                <button class="action-button" title="Copy">
                                    <span class="material-icons">content_copy</span>
                                </button>
                            </div>
                        </div>
                    `;
                    
                    chatMessages.appendChild(messageDiv);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                    
                    showToast(isHindi ? 'कॉपी किया गया' : 'Copied', isHindi ? 'छवि चैट में कॉपी कर दी गई है।' : 'Image copied to chat.');
                });
                
                showToast(isHindi ? 'सफल' : 'Success', isHindi ? 'छवि उत्पन्न हो गई है!' : 'Image generated successfully!');
                
                // Scroll to bottom of gallery
                imageGallery.scrollTop = imageGallery.scrollHeight;
            }, 3000);
        }

        // Mark notification as read
        function markNotificationAsRead(notifId) {
            const notifIndex = sampleNotifications.findIndex(n => n.id === notifId);
            if (notifIndex !== -1 && !sampleNotifications[notifIndex].read) {
                sampleNotifications[notifIndex].read = true;
                renderNotifications();
                
                // Show toast
                const notif = sampleNotifications[notifIndex];
                showToast(notif.title, notif.message);
            }
        }

        // Show toast notification
        function showToast(title, message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `
                <span class="material-icons toast-icon">notifications</span>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close">
                    <span class="material-icons">close</span>
                </button>
            `;
            
            toastContainer.appendChild(toast);
            
            // Play sound if enabled
            if (soundToggle.checked) {
                playNotificationSound();
            }
            
            // Vibrate if enabled and supported
            if (vibrationToggle.checked && 'vibrate' in navigator) {
                navigator.vibrate(200);
            }
            
            // Remove after 5 seconds
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    toastContainer.removeChild(toast);
                }, 300);
            }, 5000);
            
            // Close button
            toast.querySelector('.toast-close').addEventListener('click', function() {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    toastContainer.removeChild(toast);
                }, 300);
            });
        }

        // Play notification sound
        function playNotificationSound() {
            // Create an audio context
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // Create oscillator
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 440; // A4 note
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.01);
            gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.3);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        }

        // Show confirm modal
        function showConfirmModal(message, onConfirm) {
            confirmMessage.textContent = message;
            confirmModal.style.display = 'flex';
            
            // Store the confirm action
            confirmAction.onclick = function() {
                onConfirm();
                hideConfirmModal();
            };
        }

        // Hide confirm modal
        function hideConfirmModal() {
            confirmModal.style.display = 'none';
        }

        // Install PWA
        function installPWA() {
            showToast(isHindi ? 'स्थापित किया गया' : 'Installed', isHindi ? 'Milli Ai अब आपके डिवाइस पर स्थापित है!' : 'Milli Ai is now installed on your device!');
            installPrompt.classList.remove('show');
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html> 
